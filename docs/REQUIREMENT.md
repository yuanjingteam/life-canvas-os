# Life Canvas OS 产品需求文档（PRD）

**文档版本**：v1.0
**创建日期**：2026-02-03
**最后更新**：2026-02-03
**文档状态**：草稿

---

## 一、项目基础信息

### 1.1 项目名称与版本

| 项目 | 信息 |
|------|------|
| **项目名称** | Life Canvas OS |
| **产品定位** | 基于八维量化模型的 AI 驱动个人成长桌面操作系统 |
| **当前版本** | v1.0.0（MVP） |
| **目标平台** | 桌面应用（Windows / macOS / Linux） |

### 1.2 需求范围

#### ✅ 需要做（MVP 范围）

**核心功能模块**
- 八维生命平衡系统（饮食、运动、读书、工作、梦想、财务、社交、环境）
- AI 智能洞察（DeepSeek/豆包二选一）
- 用户日记系统（支持附件、编辑历史）
- 数据可视化（雷达图、趋势图）
- 数据导入导出（跨设备迁移）
- PIN 码安全保护（可选）

**全局功能**
- 系统设置管理
- 数据自动保存
- 跨设备数据迁移
- 应用自启动与锁定

#### ❌ 不做（留待后续版本）

**Phase 2 功能**
- 数据云端备份与同步
- 移动端适配
- 插件系统
- 社区分享与模板市场
- 自动化习惯养成计划
- AI 对话式助手

---

## 二、需求背景与目标

### 2.1 需求背景

#### 业务痛点

**问题 1：生活管理碎片化**
> 现状：用户使用多个工具管理生活（记账用 App、运动用手环、读书用阅读软件、日记用笔记本），数据分散，无法形成整体视角。
> 痛点：无法看到生活各维度的平衡状态，顾此失彼。

**问题 2：缺乏数据驱动的决策依据**
> 现状：用户凭感觉判断生活状态（"我觉得最近挺健康的"），没有量化数据支撑。
> 痛点：主观判断容易出错，无法发现潜在问题和趋势。

**问题 3：AI 工具缺乏个性化上下文**
> 现状：通用 AI 助手不了解用户的生活数据，只能给出泛泛而谈的建议。
> 痛点：建议缺乏针对性，无法真正指导行动。

**问题 4：隐私安全顾虑**
> 现状：数据存储在云端服务器，用户担心隐私泄露。
> 痛点：不敢记录真实的想法和敏感信息。

#### 用户需求

| 用户类型 | 核心需求 |
|----------|----------|
| **量化自我爱好者** | 用数据追踪生活各维度，需要可视化分析和趋势洞察 |
| **自我提升者** | 需要明确的目标管理和进度追踪，需要个性化建议 |
| **知识工作者** | 需要系统化工具管理多维度生活，追求效率与平衡 |
| **隐私敏感用户** | 需要本地化存储，完全掌控自己的数据 |

### 2.2 核心目标

#### 业务目标

| 目标 | 衡量指标 | 目标值 |
|------|----------|--------|
| **用户留存** | 7日留存率 | ≥ 60% |
| **用户活跃** | 周活跃用户占比 | ≥ 40% |
| **功能使用** | AI 洞察功能使用率 | ≥ 80% |
| **数据完整性** | 平均每日记录数据点数 | ≥ 5 条/天 |
| **用户满意度** | NPS（净推荐值） | ≥ 50 |

#### 用户价值目标

- **提升自我认知效率**：用户能够在一分钟内了解当前生活状态（八维雷达图）
- **获得个性化洞察**：AI 基于用户数据提供针对性建议（准确率 ≥ 80%）
- **建立数据驱动习惯**：用户养成每日记录习惯（连续记录天数 ≥ 21 天）
- **保护数据隐私**：所有数据本地存储，用户完全掌控

### 2.3 目标用户与使用场景

#### 目标用户画像

**主要用户：量化自我爱好者**
- 年龄：25-40 岁
- 职业：程序员、产品经理、数据分析师、设计师
- 特征：喜欢用数据说话，追求自我提升，有一定技术背景
- 痛点：生活管理工具分散，缺乏整体视角

**次要用户：自我提升者**
- 年龄：20-35 岁
- 职业：学生、职场新人、自由职业者
- 特征：有明确目标，需要工具辅助达成
- 痛点：执行力不足，缺乏反馈机制

#### 核心使用场景

**场景 1：每日复盘（高频场景）**
> 时间：每天晚上 9-11 点
> 行为：
> 1. 打开应用，查看八维雷达图，了解今日状态
> 2. 点击各子系统，更新今日数据和日志
> 3. 查看系统提示，记录偏离基准的行为
> 4. 写日记，记录今日心情和感悟
> 5. 查看趋势图，了解本周/本月变化

**场景 2：周/月度回顾（中频场景）**
> 时间：每周日晚上 / 每月最后一天
> 行为：
> 1. 查看时间轴审计页面，回顾本周/月所有记录
> 2. 点击"启动 AI 洞察"，获取 AI 分析报告
> 3. 根据洞察建议，调整下周/月的目标和计划
> 4. 查看趋势图，识别进步和退步的维度

**场景 3：目标规划（低频场景）**
> 时间：新年开始 / 生日 / 重要节点
> 行为：
> 1. 进入系统设置，更新基本信息和价值观
> 2. 进入梦想系统，添加新的梦想目标
> 3. 进入各子系统，设置新的基准和里程碑
> 4. 查看生命进度条，重新审视人生规划

**场景 4：跨设备迁移（低频但关键场景）**
> 时间：更换电脑 / 重装系统
> 行为：
> 1. 在旧设备上导出数据包（ZIP 格式）
> 2. 将数据包传输到新设备
> 3. 在新设备上导入数据包，恢复所有数据

---

## 三、核心功能需求

### 3.1 功能模块总览

```
Life Canvas OS
├── 启动与认证
│   ├── 首次启动引导
│   ├── PIN 码设置（可选）
│   └── PIN 码解锁
├── 全局画布（首页）
│   ├── 八维雷达图
│   ├── 子系统概览卡片
│   └── 快速操作区
├── 子系统管理（8 个）
│   ├── 饮食系统（FUEL）✅ MVP 优先实现
│   ├── 运动系统（PHYSICAL）⏳ Phase 2
│   ├── 读书系统（INTELLECTUAL）⏳ Phase 2
│   ├── 工作系统（OUTPUT）⏳ Phase 2
│   ├── 梦想系统（RECOVERY）⏳ Phase 2
│   ├── 财务系统（ASSET）⏳ Phase 2
│   ├── 社交系统（CONNECTION）⏳ Phase 2
│   └── 环境系统（ENVIRONMENT）⏳ Phase 2
├── AI 洞察中心
│   ├── 手动生成洞察
│   ├── 洞察历史查看
│   └── AI 配置管理
├── 用户日记
│   ├── 日记撰写（支持附件）
│   ├── 日记列表与搜索
│   ├── 日记统计与可视化
│   └── 编辑历史查看
├── 时间轴审计
│   ├── 全系统日志时间轴
│   ├── 按系统筛选
│   └── 按时间范围筛选
└── 系统设置
    ├── 用户档案管理
    ├── AI 配置（DeepSeek/豆包二选一）
    ├── 数据导入导出（跨设备迁移）
    ├── 主题与语言设置
    └── 自动保存配置
```

### 3.2 全局核心业务流程

#### 3.2.1 应用启动与认证流程

**用户故事**
> 作为一名注重隐私的用户，我希望在打开应用时需要输入 PIN 码，这样即使我离开电脑，其他人也无法查看我的生活数据。

**正常流程**

```
[用户双击应用图标]
    ↓
[Electron 启动 Python 后端进程]
    ↓
[Python 初始化 SQLite 数据库]
    ↓
[建立 IPC 通信通道]
    ↓
{判断：是否首次启动？}
    ├─ 是 → [显示欢迎引导页]
    │        ↓
    │    [用户填写基本信息]
    │        ↓
    │    {判断：是否设置 PIN 码？}
    │        ├─ 是 → [输入 6 位 PIN 码] → [确认 PIN 码] → [完成设置]
    │        └─ 否 → [跳过 PIN 设置] → [直接进入应用]
    │
    └─ 否 → {判断：是否设置了 PIN 码？}
              ├─ 是 → [显示 PIN 解锁界面]
              │        ↓
              │    [用户输入 6 位 PIN 码]
              │        ↓
              │    {验证 PIN 码}
              │        ├─ 成功 → [进入应用]
              │        └─ 失败 → [显示错误提示]
              │                  ↓
              │              {判断：连续错误次数？}
              │                  ├─ < 5 次 → [重新输入]
              │                  └─ ≥ 5 次 → [锁定 30 秒] → [显示倒计时]
              │
              └─ 否 → [直接进入应用]
```

**交互规则**

| 场景 | 规则 |
|------|------|
| **PIN 码格式** | 6 位数字，不能重复（如 111111 不允许） |
| **PIN 码修改** | 3 天内只能修改 1 次 |
| **连续错误锁定** | 连续错误 5 次后锁定 30 秒 |
| **忘记 PIN 码** | 无恢复机制，清除数据库重新设置（用户需自行承担数据丢失风险） |
| **自动锁定** | 应用锁定 5 分钟后，需要重新输入 PIN 码 |

**异常处理**

| 异常场景 | 处理方式 |
|----------|----------|
| Python 后端启动失败 | 显示错误提示，提供"重试"和"查看日志"按钮 |
| 数据库初始化失败 | 显示错误提示，提供"重试"和"重置数据库"按钮 |
| IPC 通信建立失败 | 显示错误提示，自动重启 Python 进程 |
| PIN 码验证超时 | 显示"处理中"状态，超时 5 秒后提示"重试" |

---

#### 3.2.2 AI 洞察生成流程

**用户故事**
> 作为一名追求自我提升的用户，我希望 AI 能够基于我的八维数据提供个性化建议，这样我能够更清晰地知道自己需要改进的方向。

**正常流程**

```
[用户点击"启动 AI 洞察"按钮]
    ↓
{判断：是否已配置 AI？}
    ├─ 否 → [跳转到 AI 配置页面]
    └─ 是 → [显示加载状态："正在分析您的数据..."]
            ↓
        [前端收集当前八维评分数据]
            ↓
        [通过 IPC 发送到 Python 后端]
            ↓
        [Python 从数据库读取用户配置的 API Key]
            ↓
        [Python 解密 API Key（AES-256-GCM）]
            ↓
        [Python 构建 Prompt（包含八维评分）]
            ↓
        [Python 调用大模型 API（DeepSeek/豆包）]
            ↓
        {等待响应（最长 60 秒）}
            ↓
        [Python 解析 JSON 响应]
            ↓
        {判断：响应格式是否正确？}
            ├─ 是 → [存储到 insights 表]
            │        ↓
            │    [通过 IPC 返回给前端]
            │        ↓
            │    [前端渲染 3 条洞察卡片]
            │        ↓
            │    [卡片类型：庆祝型 / 警告型 / 行动型]
            │
            └─ 否 → {判断：重试次数 < 3 次？}
                      ├─ 是 → [重试调用 API]
                      └─ 否 → [显示默认建议]
```

**交互规则**

| 规则项 | 具体规则 |
|--------|----------|
| **触发方式** | 手动点击触发，不支持自动生成 |
| **生成频率限制** | 用户自定义（默认每天最多 3 次，可修改） |
| **响应时间要求** | 60 秒内返回结果 |
| **洞察保留时长** | 保留最近 30 天的洞察记录，自动删除超过 30 天的记录 |
| **洞察类型** | 固定 3 条：celebration（庆祝）、warning（警告）、action（行动） |
| **失败重试** | 自动重试 3 次，间隔 2 秒 |
| **失败处理** | 3 次都失败后显示预设的默认建议 |

**洞察卡片内容规范**

| 类型 | 颜色 | 图标 | 内容要求 |
|------|------|------|----------|
| **celebration** | 绿色 | Trophy | 针对得分最高的维度，表扬用户做得好的地方 |
| **warning** | 红色 | AlertCircle | 针对得分最低的维度，警告潜在风险 |
| **action** | 蓝色 | Zap | 提供一条具体的、可操作的改进建议 |

**异常处理**

| 异常场景 | 处理方式 |
|----------|----------|
| 未配置 AI | 显示"请先配置 AI"提示，跳转到配置页面 |
| API Key 无效 | 显示"API Key 无效，请重新配置" |
| API 调用超时（>60秒） | 显示"生成超时，请稍后重试" |
| 网络连接失败 | 显示"网络连接失败，请检查网络" |
| API 额度耗尽 | 显示"API 额度不足，请充值或切换提供商" |
| 响应格式错误 | 重试 3 次后显示默认建议 |

---

#### 3.2.3 数据导入导出流程（跨设备迁移）

**用户故事**
> 作为一名可能更换电脑的用户，我希望能够将所有数据导出并在新设备上恢复，这样我不用担心更换设备导致数据丢失。

**正常流程（导出）**

```
[用户进入"系统设置" → "数据管理"]
    ↓
[点击"导出数据"按钮]
    ↓
{判断：是否有未保存的更改？}
    ├─ 是 → [自动保存所有数据]
    └─ 否 → [继续]
    ↓
[显示导出进度："正在准备数据包..."]
    ↓
[Python 执行以下操作]
    ├─ 1. 导出 SQLite 数据库为 JSON
    ├─ 2. 收集所有附件文件（日记附件）
    ├─ 3. 计算文件哈希值（校验完整性）
    └─ 4. 打包为 ZIP（包含 data.json + files/ 目录）
    ↓
[显示"选择保存位置"对话框]
    ↓
[用户选择保存路径]
    ↓
[写入 ZIP 文件]
    ↓
{判断：导出是否成功？}
    ├─ 是 → [显示"导出成功！" + 文件大小 + 文件路径]
    └─ 否 → [显示错误日志] → [提供"重试"按钮]
```

**正常流程（导入）**

```
[用户进入"系统设置" → "数据管理"]
    ↓
[点击"导入数据"按钮]
    ↓
[显示文件选择对话框（限制 ZIP 格式）]
    ↓
[用户选择数据包 ZIP 文件]
    ↓
[显示导入预览页面]
    ├─ 显示数据包信息（导出时间、版本、数据量）
    ├─ 显示内容摘要（日记数量、日志数量、附件数量）
    └─ 显示警告提示："导入将覆盖当前所有数据，是否继续？"
    ↓
{用户确认}
    ↓
[显示导入进度："正在导入数据..."]
    ↓
[Python 执行以下操作]
    ├─ 1. 解压 ZIP 文件到临时目录
    ├─ 2. 校验文件完整性（哈希值比对）
    ├─ 3. 备份当前数据库（data.db.backup）
    ├─ 4. 清空当前数据库表
    ├─ 5. 导入 JSON 数据到数据库
    ├─ 6. 复制附件文件到 files/ 目录
    └─ 7. 运行数据迁移脚本（版本兼容性处理）
    ↓
{判断：导入是否成功？}
    ├─ 是 → [显示"导入成功！已恢复 XX 条数据"]
    │        ↓
    │    [自动重启应用]
    │        ↓
    │    [显示 PIN 解锁界面（如果设置了 PIN）]
    │
    └─ 否 → [显示错误日志]
            ↓
        {判断：备份文件是否存在？}
            ├─ 是 → [提供"恢复备份"按钮] → [回滚到导入前状态]
            └─ 否 → [显示"数据可能损坏，请联系支持"]
```

**数据包格式规范**

```
life-canvas-os-export-20250203.zip
├── manifest.json              # 元数据（版本、时间、校验和）
├── data.json                  # 所有数据（JSON 格式）
└── files/                     # 附件文件
    ├── journals/
    │   ├── 2024/
    │   └── 2025/
    └── thumbnails/
```

**manifest.json 格式**
```json
{
  "version": "1.0.0",
  "exported_at": "2026-02-03T10:30:00Z",
  "user_id": 1,
  "checksum": "sha256:abc123...",
  "stats": {
    "journals": 365,
    "logs": 5840,
    "attachments": 120
  }
}
```

**交互规则**

| 规则项 | 具体规则 |
|--------|----------|
| **导出格式** | ZIP 压缩包（包含 JSON 数据 + 附件文件） |
| **加密** | 暂不加密（用户可后续手动加密 ZIP） |
| **版本兼容性** | 自动识别数据包版本，运行迁移脚本 |
| **导入覆盖** | 导入会完全覆盖当前数据，需用户明确确认 |
| **自动备份** | 导入前自动备份当前数据库 |
| **失败回滚** | 导入失败后提供回滚选项 |

**异常处理**

| 异常场景 | 处理方式 |
|----------|----------|
| 磁盘空间不足 | 显示"磁盘空间不足，需要至少 XX MB 空间" |
| ZIP 文件损坏 | 显示"数据包已损坏，请重新导出" |
| 校验和不匹配 | 显示"数据包被篡改，导入终止" |
| 版本不兼容 | 显示"数据包版本过旧/过新，无法导入" |
| 导入中断（用户取消） | 自动回滚到导入前状态，删除临时文件 |

---

### 3.3 饮食系统（FUEL）详细需求

#### 3.3.1 功能概述

**定位**：通过基准线模型管理日常饮食，仅记录偏离事件，培养健康的饮食习惯。

**核心理念**：
- **基准线思维**：定义"正常饮食"的标准，自动按基准执行
- **异常记录**：只在偏离基准时记录，减少记录负担
- **AI 辅助分析**：利用 AI 计算热量、分析营养、提供改进建议

#### 3.3.2 用户故事

**故事 1：定义基准饮食**
> 作为一名追求健康的用户，我希望设置每日饮食基准（如早餐吃燕麦片+煎蛋），这样我不需要每天记录吃了什么，只需要在偏离时记录。

**故事 2：记录偏离事件**
> 作为一名需要社交的用户，我希望在参加聚餐时记录"偏离基准"的事件（如：晚上聚餐吃火锅），这样系统能够分析我的饮食习惯，并给出改进建议。

**故事 3：查看一致性评分**
> 作为一名量化自我爱好者，我希望看到我的饮食一致性评分（如：92%），这样我能够直观了解自己遵守基准饮食的程度。

**故事 4：AI 热量分析**
> 作为一名控制体重的用户，我希望 AI 能够根据我的饮食记录自动计算热量，这样我不需要手动查询每种食物的热量。

**故事 5：偏离提醒**
> 作为一名需要监督的用户，希望在我记录偏离事件后，系统能够提醒我"本月已偏离 5 次，注意控制"，这样我能够及时调整。

#### 3.3.3 数据模型

**饮食系统专属字段（systems_fuel 表）**

```sql
CREATE TABLE systems_fuel (
    system_id INTEGER PRIMARY KEY,              -- 关联 systems_base.id
    consistency INTEGER DEFAULT 0 CHECK(consistency BETWEEN 0 AND 100),  -- 一致性评分（0-100）
    baseline_breakfast TEXT,                    -- 早餐基准配置（JSON）
    baseline_lunch TEXT,                        -- 午餐基准配置（JSON）
    baseline_dinner TEXT,                       -- 晚餐基准配置（JSON）
    baseline_snacks TEXT,                       -- 零食基准配置（JSON）
    last_deviation TEXT,                        -- 最近偏离记录（JSON）
    total_deviations INTEGER DEFAULT 0,         -- 总偏离次数
    monthly_deviations INTEGER DEFAULT 0,       -- 本月偏离次数
    ai_calories_estimated REAL,                 -- AI 估算的日均热量（大卡）
    ai_nutrition_analysis TEXT,                 -- AI 营养分析（JSON）
    deviation_reminder_enabled INTEGER DEFAULT 1,  -- 偏离提醒开关（1=开启，0=关闭）
    FOREIGN KEY (system_id) REFERENCES systems_base(id) ON DELETE CASCADE
);
```

**基准饮食配置（JSON 格式）**

```json
{
  "enabled": true,
  "meals": [
    {
      "name": "燕麦片+煎蛋",
      "type": "breakfast",
      "ingredients": [
        {"name": "燕麦片", "amount": "50g", "calories": 180},
        {"name": "鸡蛋", "amount": "2个", "calories": 140},
        {"name": "牛奶", "amount": "250ml", "calories": 130}
      ],
      "total_calories": 450,
      "notes": "周一至周五"
    }
  ],
  "snacks_enabled": false,
  "snack_rules": "无零食"
}
```

**偏离记录（JSON 格式）**

```json
{
  "id": "dev_20250203_001",
  "timestamp": "2026-02-03T19:30:00Z",
  "meal_type": "dinner",
  "event": "社交聚餐",
  "description": "和朋友去吃海底捞火锅",
  "reason": "朋友生日",
  "impact_score": -5,  // 影响评分（负分=负面影响）
  "estimated_calories": 1200,
  "photos": ["files/journals/2026/feb/dev_001_photo.jpg"]
}
```

#### 3.3.4 核心业务流程

**流程 1：首次设置基准饮食**

```
[用户进入饮食系统详情页]
    ↓
[点击"设置基准饮食"按钮]
    ↓
[显示基准饮食配置向导（3 步）]
    ↓
    步骤 1：选择启用餐型
    └─ [ ] 早餐  [ ] 午餐  [ ] 晚餐  [ ] 零食
    ↓
    步骤 2：配置每餐内容
    └─ 对于每餐：
        ├─ 输入餐名（如："燕麦片+煎蛋"）
        ├─ 添加食材（名称 + 分量）
        ├─ 选择适用时间（如：周一至周五）
        └─ 选择是否启用 AI 热量估算
    ↓
    步骤 3：偏离规则设置
    ├─ [ ] 启用偏离提醒（每次偏离后通知）
    ├─ [ ] 启用月度偏离预警（如：超过 5 次提醒）
    └─ 输入月度偏离阈值（默认 5 次）
    ↓
[点击"完成设置"]
    ↓
[系统自动计算初始一致性评分（100%）]
    ↓
[返回饮食系统首页，显示基准配置]
```

**流程 2：记录偏离事件**

```
[用户进入饮食系统详情页]
    ↓
[点击"记录偏离"按钮]
    ↓
[显示偏离记录表单]
    ├─ 选择餐型：[早餐 ▼] / 午餐 / 晚餐 / 零食
    ├─ 偏离类型：[社交聚餐 ▼] / 加餐 / 外卖 / 节日 / 其他
    ├─ 时间：[2026-02-03 19:30]（默认当前时间）
    ├─ 描述：[和朋友去吃海底捞火锅____________]
    ├─ 原因：[朋友生日____________]（可选）
    ├─ 上传照片：[+ 添加照片]（可选，最多 3 张）
    └─ [ ] 启用 AI 热量估算（默认勾选）
    ↓
[点击"保存偏离记录"]
    ↓
{判断：是否启用 AI 热量估算？}
    ├─ 是 → [调用 AI API 估算热量]
    │        ↓
    │    [返回估算热量：1200 大卡]
    │
    └─ 否 → [跳过热量估算]
    ↓
[计算新的一致性评分]
    └─ 公式：consistency = 100 - (total_deviations × 2)
    └─ 示例：100 - (4 × 2) = 92 分
    ↓
{判断：是否启用偏离提醒？}
    ├─ 是 → [发送系统通知]
    │        └─ 内容："🍽️ 本月已偏离 4 次，距离阈值还差 1 次"
    └─ 否 → [跳过提醒]
    ↓
[更新饮食系统评分]
    └─ new_score = base_score - (deviation_impact)
    └─ 示例：92 - 5 = 87 分
    ↓
[显示"偏离记录已保存" + 热量估算]
    ↓
[返回饮食系统首页]
```

**流程 3：查看一致性报告**

```
[用户进入饮食系统详情页]
    ↓
[点击"一致性报告"卡片]
    ↓
[显示一致性分析页面]
    ├─ 一致性评分：92 分（环比上周 ↓ 2%）
    │   └─ [雷达图显示本周趋势]
    ├─ 偏离统计
    │   ├─ 总偏离次数：4 次
    │   ├─ 本月偏离：4 次 / 阈值 5 次
    │   └─ 偏离原因分布
    │       ├─ 社交聚餐：50%（2 次）
    │       ├─ 加班外卖：25%（1 次）
    │       └─ 节日：25%（1 次）
    ├─ AI 营养分析
    │   ├─ 日均热量：2100 大卡（目标：2000 大卡）
    │   ├─ 营养结构
    │   │   ├─ 碳水化合物：50%
    │   │   ├─ 蛋白质：25%
    │   │   └─ 脂肪：25%
    │   └─ AI 建议："蛋白质摄入偏低，建议增加鱼、肉、蛋"
    └─ 周/月趋势图
        ├─ 折线图显示一致性评分变化
        └─ 柱状图显示偏离次数分布
```

**流程 4：AI 热量与营养分析**

```
[用户在偏离记录表单中勾选"启用 AI 热量估算"]
    ↓
[点击"保存偏离记录"]
    ↓
[前端发送偏离数据到 Python 后端]
    ↓
[Python 构建 Prompt]
    └─ 内容："请估算以下饮食的热量和营养成分：
         餐型：晚餐
         描述：海底捞火锅
         包含：牛肉卷、虾滑、豆腐、蔬菜、火锅底料"
    ↓
[Python 调用 AI API（DeepSeek/豆包）]
    ↓
[AI 返回 JSON 格式分析结果]
    {
      "estimated_calories": 1200,
      "nutrition": {
        "carbs": {"grams": 80, "percentage": 27},
        "protein": {"grams": 60, "percentage": 20},
        "fat": {"grams": 50, "percentage": 53}
      },
      "advice": "脂肪含量较高，建议下次多涮蔬菜，少吃底料"
    }
    ↓
[Python 存储分析结果到 ai_nutrition_analysis 字段]
    ↓
[返回给前端]
    ↓
[前端显示分析结果]
    ├─ "🔥 热量估算：1200 大卡"
    ├─ "📊 营养成分：碳水 27%、蛋白质 20%、脂肪 53%"
    └─ "💡 AI 建议：脂肪含量较高，建议下次多涮蔬菜"
```

#### 3.3.5 交互规则

| 规则项 | 具体规则 |
|--------|----------|
| **一致性评分计算** | `consistency = 100 - (total_deviations × 2)`，最低 0 分 |
| **偏离影响评分** | 每次偏离扣除 5 分系统评分，当天多次偏离不重复扣分 |
| **月度偏离阈值** | 默认 5 次，用户可自定义（范围：3-10 次） |
| **偏离提醒触发** | 记录偏离后立即提醒 + 达到阈值 80% 时预警 |
| **AI 热量估算** | 默认启用，用户可选择关闭 |
| **AI 营养分析** | 仅在有 ≥ 3 条偏离记录时生成 |
| **趋势图时间范围** | 支持本周、本月、近 3 个月三个维度 |
| **基准餐修改** | 30 天内只能修改 1 次（防止频繁修改） |
| **偏离记录编辑** | 记录后 24 小时内可编辑，超过 24 小时锁定 |
| **偏离记录删除** | 支持删除，但会保留删除记录（审计日志） |

#### 3.3.6 异常处理

| 异常场景 | 处理方式 |
|----------|----------|
| AI 热量估算失败 | 显示"热量估算失败，请稍后再试"，不影响偏离记录保存 |
| 基准餐配置为空 | 显示"请先设置基准饮食"，引导用户配置 |
| 偏离记录上传照片失败 | 显示"照片上传失败，但文字记录已保存" |
| 一致性评分为 0 | 显示警告提示："一致性评分为 0，建议重新审视基准饮食设置" |
| 月度偏离超过阈值 | 发送系统通知 + 在首页显示警告卡片 |
| AI 营养分析返回异常 | 显示"AI 分析暂不可用"，隐藏分析卡片 |

---

### 3.4 其他全局功能需求

#### 3.4.1 用户日记系统

**用户故事**
> 作为一名记录生活点滴的用户，我希望能够在应用中写日记、上传照片、记录心情，这样我能够回顾自己的成长轨迹。

**核心功能**
- 日记撰写（支持 Markdown 编辑器）
- 附件上传（图片/PDF/Word/视频，单文件最大 5MB，每篇最多 3 个附件）
- 心情记录（5 种心情：great/good/neutral/bad/terrible）
- 标签管理（自定义标签，支持关联子系统）
- 编辑历史查看（保留最近 10 次编辑版本）
- 日记搜索（按时间、心情、标签、关键词搜索）

**交互规则**

| 规则项 | 具体规则 |
|--------|----------|
| **日记字数限制** | 最大 10000 字 |
| **附件限制** | 单文件 5MB，每篇最多 3 个附件 |
| **附件类型** | 图片（jpg/png/gif）、PDF、Word（docx）、视频（mp4/mov） |
| **缩略图生成** | 图片自动生成 300x300 缩略图 |
| **编辑历史** | 保留最近 10 次编辑版本，超过 10 次删除最旧版本 |
| **日记删除** | 支持软删除（30 天内可恢复）和硬删除（永久删除） |

---

#### 3.4.2 时间轴审计

**用户故事**
> 作为一名回顾历史的用户，我希望在一条时间轴上查看所有系统的日志记录，这样我能够全面回顾自己的成长轨迹。

**核心功能**
- 全系统日志时间轴（倒序排列）
- 按系统筛选（8 个子系统复选筛选）
- 按时间范围筛选（日/周/月/自定义）
- 按日志标签筛选
- 时间轴导出（PDF/Markdown）

---

#### 3.4.3 系统设置

**用户档案管理**
- 基本信息（姓名、生日、MBTI、价值观）
- 生命进度条（显示已度过时间/预期寿命）
- 预期寿命设置

**AI 配置管理**
- 提供商选择（DeepSeek/豆包二选一）
- API Key 配置（加密存储）
- API 连通性测试
- 生成频率限制设置

**数据管理**
- 数据导出（ZIP 格式）
- 数据导入（跨设备迁移）
- 数据清除（重置应用）
- 自动备份配置

**外观与行为**
- 主题设置（light/dark/auto）
- 语言设置（简体中文/English）
- 自动保存间隔（默认 60 秒）
- 通知设置（开启/关闭系统通知）

---

## 四、非功能需求

### 4.1 性能要求

| 性能指标 | 要求 | 测量方法 |
|----------|------|----------|
| **应用启动时间** | ≤ 3 秒（从双击图标到显示主界面） | 从应用启动到 `window.show()` 完成的时间 |
| **数据库查询响应** | ≤ 1 秒（加载系统数据） | 从发起查询到数据渲染完成的时间 |
| **AI 洞察生成** | ≤ 60 秒（从点击到显示结果） | 从发起请求到洞察卡片渲染完成 |
| **页面切换响应** | ≤ 300ms（点击导航到页面切换完成） | 从点击事件到新页面完全渲染的时间 |
| **数据导出耗时** | ≤ 120 秒（10 万条记录 + 100 个附件） | 从点击导出到 ZIP 文件写入完成 |
| **数据导入耗时** | ≤ 120 秒（10 万条记录 + 100 个附件） | 从选择文件到数据完全导入 |
| **内存占用** | ≤ 500MB（正常运行，无大文件操作） | 任务管理器显示的内存占用 |
| **CPU 占用** | ≤ 5%（空闲状态） | 任务管理器显示的 CPU 占用 |
| **磁盘占用** | ≤ 200MB（首次安装，不含用户数据） | 安装目录大小 |

**性能优化策略**
- 数据库索引优化（所有时间字段建索引）
- 图片懒加载（缩略图优先显示）
- 虚拟滚动（长列表只渲染可见区域）
- 缓存策略（React Query 缓存查询结果）
- 增量更新（只更新变化的数据，不刷新整个页面）

---

### 4.2 兼容要求

#### 操作系统支持

| 平台 | 最低版本 | 推荐版本 | 测试覆盖率 |
|------|----------|----------|------------|
| **Windows** | Windows 10 1903 | Windows 11 | 100% |
| **macOS** | macOS 11 Big Sur | macOS 14 Sonoma | 100% |
| **Linux** | Ubuntu 20.04 LTS | Ubuntu 22.04 LTS | 80%（主流发行版） |

#### 硬件要求

| 硬件 | 最低配置 | 推荐配置 |
|------|----------|----------|
| **CPU** | Intel i3 / AMD Ryzen 3 | Intel i5 / AMD Ryzen 5 |
| **内存** | 4GB RAM | 8GB RAM |
| **磁盘** | 500MB 可用空间 | 1GB 可用空间 |
| **分辨率** | 1280×720 | 1920×1080 或更高 |

#### 软件依赖

| 依赖 | 版本要求 | 说明 |
|------|----------|------|
| **Python** | 3.11+ | 后端服务（打包时内嵌） |
| **Node.js** | 18+ | 开发环境构建（用户无需安装） |
| **SQLite** | 3.38+ | 数据库（打包时内嵌） |

#### DPI 适配
- 支持 100% / 125% / 150% / 200% DPI 缩放
- 高分屏（Retina）适配
- 文字和图标自动缩放

---

### 4.3 安全要求

#### 数据安全

| 安全措施 | 实现方式 | 目的 |
|----------|----------|------|
| **本地数据存储** | SQLite 数据库存储在用户数据目录 | 防止云端泄露 |
| **API Key 加密** | AES-256-GCM + 系统密钥链（Keychain） | 防止 API Key 泄露 |
| **PIN 码哈希** | bcrypt 哈希（salt = 10 轮） | 防止 PIN 码明文存储 |
| **进程隔离** | Electron 上下文隔离 + 禁用 Node 集成 | 防止渲染进程访问系统资源 |
| **IPC 通信安全** | 消息白名单机制 | 防止未授权的 IPC 调用 |
| **附件沙箱** | 附件存储在应用目录，禁止执行 | 防止恶意文件执行 |

#### 隐私保护

| 隐私措施 | 说明 |
|----------|------|
| **无数据上传** | 所有数据仅在本地存储，不上传到任何服务器 |
| **无用户追踪** | 不收集任何用户行为数据、设备信息 |
| **无第三方统计** | 不集成 Google Analytics、Mixpanel 等统计工具 |
| **开源透明** | 后端代码开源（可选），用户可自行审计 |
| **数据导出** | 用户可随时导出所有数据，携带离开 |

#### PIN 码安全策略

| 策略 | 规则 |
|------|------|
| **PIN 格式** | 6 位数字，不能是重复数字（如 111111） |
| **连续失败锁定** | 连续错误 5 次后锁定 30 秒 |
| **修改频率限制** | 3 天内只能修改 1 次 |
| **忘记 PIN 码** | 无恢复机制，需清除数据库重新设置 |
| **自动锁定** | 应用锁定 5 分钟后，需要重新输入 PIN 码 |

#### 加密算法

| 用途 | 算法 | 密钥长度 |
|------|------|----------|
| **API Key 加密** | AES-256-GCM | 256 位 |
| **PIN 码哈希** | bcrypt | salt = 10 轮 |
| **数据传输校验** | SHA-256 | 256 位 |

---

### 4.4 易用性要求

#### 用户体验标准

| 体验维度 | 要求 | 验收标准 |
|----------|------|----------|
| **界面简洁** | 核心功能 3 次点击可达 | 用户测试：90% 用户能在 3 次点击内找到功能 |
| **操作反馈** | 所有操作有明确的视觉反馈 | 用户测试：100% 操作有加载状态/成功提示/失败提示 |
| **错误提示** | 错误信息清晰、可操作 | 用户测试：90% 用户能理解错误提示并知道如何处理 |
| **帮助文档** | 提供内置帮助文档 | 用户测试：80% 用户能通过帮助文档独立解决问题 |

#### 首次使用引导

| 引导步骤 | 内容 |
|----------|------|
| **欢迎页** | 介绍产品定位和核心理念（可跳过） |
| **基本信息** | 收集用户姓名、生日、MBTI（可跳过） |
| **PIN 码设置** | 引导用户设置 6 位 PIN 码（可跳过） |
| **AI 配置** | 引导用户选择 AI 提供商并配置 API Key（可稍后配置） |
| **饮食系统引导** | 引导用户设置基准饮食（可稍后设置） |
| **功能概览** | 展示 8 个子系统功能（可跳过） |

#### 容错设计

| 容错场景 | 设计 |
|----------|------|
| **误操作** | 危险操作（删除数据）需要二次确认 |
| **网络中断** | AI 洞察失败时显示友好提示，不影响其他功能 |
| **数据丢失** | 导入前自动备份，提供回滚选项 |
| **应用崩溃** | 自动保存用户未保存的数据（每隔 60 秒） |
| **长时间未使用** | 显示"功能提示"卡片，引导用户回归 |

---

## 五、验收标准

### 5.1 功能验收标准

#### 全局功能验收

| 功能 | 验收标准 | 测试方法 |
|------|----------|----------|
| **应用启动** | 3 秒内显示主界面，无崩溃 | 重复启动 10 次，记录启动时间 |
| **PIN 码认证** | 连续错误 5 次锁定 30 秒 | 输入错误 PIN 5 次，验证锁定状态 |
| **八维雷达图** | 实时显示 8 个系统评分，动画流畅 | 修改系统评分，验证雷达图更新 |
| **AI 洞察生成** | 60 秒内返回 3 条洞察卡片 | 点击生成，记录响应时间 |
| **数据导出** | 生成 ZIP 包，包含完整数据和附件 | 导出后解压验证文件完整性 |
| **数据导入** | 成功导入所有数据，应用重启后数据一致 | 导入后对比数据一致性 |
| **用户日记** | 支持撰写、附件上传、编辑历史 | 创建日记、上传附件、编辑验证 |

#### 饮食系统验收

| 功能 | 验收标准 | 测试方法 |
|------|----------|----------|
| **基准饮食设置** | 成功保存 4 餐配置，JSON 格式正确 | 设置基准，验证数据库存储 |
| **一致性评分计算** | 公式：100 - (偏离次数 × 2) | 记录偏离，验证评分更新 |
| **偏离记录** | 成功保存偏离记录，AI 热量估算准确 | 记录偏离，验证热量估算误差 < 20% |
| **偏离提醒** | 记录偏离后立即提醒 | 记录偏离，验证通知触发 |
| **AI 营养分析** | 有 ≥ 3 条偏离记录后生成分析 | 记录 3 次偏离，验证分析生成 |
| **趋势图显示** | 周/月趋势图数据准确 | 对比数据库数据，验证图表正确性 |

---

### 5.2 非功能验收标准

#### 性能验收

| 指标 | 达标阈值 | 验收测试 |
|------|----------|----------|
| **启动时间** | ≤ 3 秒 | 10 次启动，平均时间 ≤ 3 秒 |
| **查询响应** | ≤ 1 秒 | 100 次查询，95% ≤ 1 秒 |
| **AI 洞察** | ≤ 60 秒 | 10 次生成，95% ≤ 60 秒 |
| **内存占用** | ≤ 500MB | 运行 1 小时，峰值 ≤ 500MB |
| **CPU 占用** | ≤ 5%（空闲） | 空闲 10 分钟，平均 ≤ 5% |

#### 兼容性验收

| 平台 | 测试用例 | 通过标准 |
|------|----------|----------|
| **Windows 10/11** | 安装、启动、核心功能、退出 | 100% 通过 |
| **macOS 11+** | 安装、启动、核心功能、退出 | 100% 通过 |
| **Ubuntu 20.04+** | 安装、启动、核心功能、退出 | 80% 通过 |

#### 安全验收

| 安全措施 | 验收标准 | 测试方法 |
|----------|----------|----------|
| **API Key 加密** | 数据库中无法找到明文 API Key | 搜索数据库文件，验证无明文 |
| **PIN 码哈希** | 数据库中无法找到明文 PIN | 搜索数据库文件，验证无明文 |
| **IPC 通信** | 未授权 IPC 调用被拒绝 | 尝试调用白名单外通道，验证拒绝 |
| **进程隔离** | 渲染进程无法访问文件系统 | DevTools 验证 `require()` 被禁用 |

---

### 5.3 边界场景验收

#### 异常场景验收

| 异常场景 | 预期行为 | 测试方法 |
|----------|----------|----------|
| **Python 后端崩溃** | 自动重启进程，显示友好提示 | 手动杀死 Python 进程，验证重启 |
| **数据库损坏** | 提示"数据库损坏"，提供恢复选项 | 损坏数据库文件，验证提示 |
| **磁盘空间不足** | 显示"磁盘空间不足"提示，不执行操作 | 填满磁盘，验证提示 |
| **API Key 无效** | 显示"API Key 无效"，引导重新配置 | 使用无效 Key，验证提示 |
| **网络中断** | 显示"网络连接失败"，不影响其他功能 | 断网后生成洞察，验证提示 |
| **超大文件导入** | 显示"文件过大"，限制导入大小 | 导入 1GB 数据包，验证拒绝 |

#### 极限场景验收

| 极限场景 | 预期行为 | 测试方法 |
|----------|----------|----------|
| **10 万条数据** | 查询响应 ≤ 2 秒 | 导入 10 万条数据，测试查询 |
| **1000 个附件** | 导入/导出时间 ≤ 60 秒 | 导入 1000 个附件，记录耗时 |
| **连续使用 24 小时** | 无内存泄漏，内存占用稳定 | 运行 24 小时，监控内存 |
| **PIN 码错误 100 次** | 每次锁定 30 秒，无法绕过 | 脚本输入错误 PIN 100 次 |

---

## 六、附录

### 6.1 术语表

| 术语 | 定义 |
|------|------|
| **八维生命平衡模型** | 将生活抽象为 8 个可量化的子系统：饮食、运动、读书、工作、梦想、财务、社交、环境 |
| **一致性评分** | 用户遵守基准饮食的程度，范围 0-100 |
| **基准线模型** | 定义"正常状态"的标准，只记录偏离事件 |
| **AI 洞察** | 基于用户数据，利用大模型生成的个性化建议 |
| **PIN 码** | 6 位数字密码，用于保护应用安全 |
| **偏离事件** | 用户行为不符合基准饮食标准的事件 |
| **跨设备迁移** | 将数据从一台设备导出，导入到另一台设备 |

### 6.2 参考文档

- [Life Canvas OS 设计文档 v3.0](./DESIGN_DOCUMENT.md)
- [Electron 官方文档](https://www.electronjs.org/docs)
- [FastAPI 官方文档](https://fastapi.tiangolo.com/)
- [shadcn/ui 组件库](https://ui.shadcn.com/)

### 6.3 变更记录

| 版本 | 日期 | 作者 | 变更内容 |
|------|------|------|----------|
| v1.0 | 2026-02-03 | Claude | 初始版本，完成 MVP 需求定义 |

---

**文档结束**
