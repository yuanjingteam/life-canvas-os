# Life Canvas OS è®¾è®¡æ–‡æ¡£

> **âš ï¸ é‡è¦æç¤ºï¼šè¿™æ˜¯è®¾è®¡è“å›¾æ–‡æ¡£**
>
> æœ¬æ–‡æ¡£æè¿°äº† Life Canvas OS çš„**å®Œæ•´è®¾è®¡æ¶æ„å’Œè§„åˆ’åŠŸèƒ½**ã€‚
>
> **å½“å‰å®ç°çŠ¶æ€ï¼š**
> - ğŸ“Š æ•´ä½“å®Œæˆåº¦ï¼šçº¦ **7-15%**
> - âœ… å·²å®Œæˆï¼šElectron + React + Python åŸºç¡€æ¡†æ¶
> - ğŸ”´ æœªå®Œæˆï¼šå¤§éƒ¨åˆ†ä¸šåŠ¡é€»è¾‘å’Œç»„ä»¶
>
> **æ–‡æ¡£ç”¨é€”ï¼š**
> - ä½œä¸ºå¼€å‘çš„è®¾è®¡ç›®æ ‡å’Œå‚è€ƒè“å›¾
> - æŒ‡å¯¼åç»­åŠŸèƒ½å¼€å‘çš„æ¶æ„æ–¹å‘
> - éå®æ—¶åæ˜ å½“å‰ä»£ç çŠ¶æ€
>
> **æ–‡æ¡£ç‰ˆæœ¬ï¼š** v3.0
> **æœ€åæ›´æ–°ï¼š** 2026-02-03
> **å®¡è®¡æ—¥æœŸï¼š** 2026-02-05

---

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®å®šä½
Life Canvas OS æ˜¯ä¸€æ¬¾åŸºäº Electron + Python + SQLite çš„æ¡Œé¢ä¸ªäººæˆé•¿æ“ä½œç³»ç»Ÿï¼Œé€šè¿‡å…«ç»´ç”Ÿå‘½å¹³è¡¡æ¨¡å‹å¸®åŠ©ç”¨æˆ·å¯è§†åŒ–ã€ç®¡ç†å’Œä¼˜åŒ–ä¸ªäººç”Ÿæ´»çš„å„ä¸ªæ–¹é¢ã€‚

### 1.2 æ ¸å¿ƒç†å¿µ
- **æœ¬åœ°ä¼˜å…ˆ**ï¼šæ•°æ®å®Œå…¨å­˜å‚¨åœ¨æœ¬åœ°ï¼Œç”¨æˆ·å®Œå…¨æŒæ§è‡ªå·±çš„æ•°æ®
- **ç³»ç»ŸåŒ–æ€ç»´**ï¼šå°†ç”Ÿæ´»æŠ½è±¡ä¸º8ä¸ªå¯é‡åŒ–çš„å­ç³»ç»Ÿ
- **æ•°æ®é©±åŠ¨**ï¼šé€šè¿‡é‡åŒ–è¯„åˆ†å’Œè¶‹åŠ¿åˆ†æè¾…åŠ©å†³ç­–
- **AIèµ‹èƒ½**ï¼šåˆ©ç”¨å¤§æ¨¡å‹ï¼ˆæ”¯æŒ DeepSeek/è±†åŒ…ï¼‰æä¾›ä¸ªæ€§åŒ–æ´å¯Ÿå’Œå»ºè®®
- **æç®€ç¾å­¦**ï¼šå€Ÿé‰´ Notion/Linear çš„è®¾è®¡è¯­è¨€ï¼Œæä¾›æ²‰æµ¸å¼ä½“éªŒ

### 1.3 ç›®æ ‡ç”¨æˆ·
- è¿½æ±‚è‡ªæˆ‘æå‡å’Œæˆé•¿çš„ä¸ªäººç”¨æˆ·
- ä¹ æƒ¯é‡åŒ–è‡ªæˆ‘ï¼ˆQuantified Selfï¼‰çš„æå®¢ç¾¤ä½“
- éœ€è¦ç³»ç»ŸåŒ–ç®¡ç†å¤šç»´åº¦ç”Ÿæ´»çš„çŸ¥è¯†å·¥ä½œè€…
- æ³¨é‡æ•°æ®éšç§å’Œå®‰å…¨çš„ç”¨æˆ·

---

## äºŒã€æŠ€æœ¯æ ˆé€‰æ‹©

### 2.1 å‰ç«¯æŠ€æœ¯æ ˆ
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Electron | 39.2.6 | æ¡Œé¢åº”ç”¨æ¡†æ¶ï¼Œè·¨å¹³å°æ”¯æŒ |
| React | 19.2.1 | UI æ¡†æ¶ |
| TypeScript | 5.9.3 | ç±»å‹å®‰å…¨ |
| Vite | 7.2.6 | æ„å»ºå·¥å…· |
| shadcn/ui | æœ€æ–° | UI ç»„ä»¶åº“ï¼ˆåŸºäº Radix UI + Tailwindï¼‰ |
| TailwindCSS | 4.1.17 | åŸå­åŒ– CSS å¼•æ“ |
| Recharts | 3.7.0 | æ•°æ®å¯è§†åŒ–ï¼ˆé›·è¾¾å›¾ç­‰ï¼‰ |
| Lucide React | æœ€æ–° | å›¾æ ‡åº“ |
| TanStack Query (React Query) | 5.90.20 | æœåŠ¡ç«¯çŠ¶æ€ç®¡ç†ä¸ç¼“å­˜ |

**çŠ¶æ€ç®¡ç†é€‰æ‹©è¯´æ˜ï¼š**
- ä½¿ç”¨ React Query ç»Ÿä¸€ç®¡ç†æœåŠ¡ç«¯çŠ¶æ€å’Œå®¢æˆ·ç«¯çŠ¶æ€
- æä¾›è‡ªåŠ¨ç¼“å­˜ã€é‡è¯•ã€å¤±æ•ˆç­–ç•¥
- é€‚åˆæ¡Œé¢åº”ç”¨çš„å•ä¸€æ•°æ®æºæ¨¡å¼

**shadcn/ui é€‰æ‹©ç†ç”±ï¼š**
- åŸºäº Radix UIï¼Œæ— éšœç¢è®¿é—®æ€§ä¼˜ç§€
- ç»„ä»¶ç›´æ¥å¤åˆ¶åˆ°é¡¹ç›®ä¸­ï¼Œå®Œå…¨å¯å®šåˆ¶
- ä¸ TailwindCSS æ·±åº¦é›†æˆï¼Œæ ·å¼ä¸€è‡´
- æä¾› Buttonã€Inputã€Modalã€Toastã€Select ç­‰å®Œæ•´ç»„ä»¶
- è®¾è®¡é£æ ¼æç®€ï¼Œç¬¦åˆé¡¹ç›®å®¡ç¾è¦æ±‚

### 2.2 åç«¯æŠ€æœ¯æ ˆ
| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Python | 3.11+ | åç«¯æœåŠ¡ |
| FastAPI | 0.100+ | é«˜æ€§èƒ½å¼‚æ­¥ API æ¡†æ¶ï¼ˆå¼€å‘ç¯å¢ƒ HTTPï¼Œç”Ÿäº§ç¯å¢ƒ IPCï¼‰ |
| SQLAlchemy | 2.0+ | ORM |
| Python æ ‡å‡†åº“ sqlite3 | å†…ç½® | SQLite é©±åŠ¨ï¼ˆæ— éœ€é¢å¤–å®‰è£…ï¼‰ |
| Pydantic | 2+ | æ•°æ®éªŒè¯ |

**æ•°æ®åº“ç®¡ç†ç­–ç•¥ï¼š**
- ä¸ä½¿ç”¨ Alembicï¼ˆæ¡Œé¢åº”ç”¨ä¸éœ€è¦å¤æ‚è¿ç§»ï¼‰
- é¦–æ¬¡å¯åŠ¨ä½¿ç”¨ `Base.metadata.create_all()` è‡ªåŠ¨å»ºè¡¨
- ç‰ˆæœ¬å‡çº§æ—¶ç¼–å†™å¢é‡è¿ç§»è„šæœ¬ï¼ˆæŒ‰éœ€æ‰§è¡Œï¼‰

### 2.3 AI é›†æˆ
ç”¨æˆ·å¯é€‰æ‹© 2 ä¸ªå¤§æ¨¡å‹æä¾›å•†ä¹‹ä¸€ï¼š
| æä¾›å•† | æ ‡è¯†ç¬¦ | è¯´æ˜ |
|--------|--------|------|
| DeepSeek | deepseek | ä¸»åŠ›æ¨èï¼Œæ€§ä»·æ¯”é«˜ï¼Œä¸­æ–‡èƒ½åŠ›å¼º |
| è±†åŒ… | doubao | å­—èŠ‚è·³åŠ¨å‡ºå“ï¼Œå“åº”å¿«é€Ÿ |

**è¯´æ˜ï¼š**
- ç”¨æˆ·åªèƒ½é…ç½®ä¸€ä¸ª AI æä¾›å•†
- å¯åœ¨è®¾ç½®é¡µé¢éšæ—¶åˆ‡æ¢
- API Key ä½¿ç”¨ AES-256-GCM åŠ å¯†å­˜å‚¨åœ¨æœ¬åœ°

### 2.4 æ•°æ®å­˜å‚¨
- **SQLite 3**ï¼šåµŒå…¥å¼æ•°æ®åº“ï¼Œå­˜å‚¨æ‰€æœ‰ç”¨æˆ·æ•°æ®
  - æ— éœ€ç‹¬ç«‹æ•°æ®åº“æœåŠ¡
  - æ•°æ®å­˜å‚¨åœ¨ç”¨æˆ·æ•°æ®ç›®å½•
  - æ”¯æŒäº‹åŠ¡ã€å¤–é”®çº¦æŸ
  - å•ç”¨æˆ·åœºæ™¯æ€§èƒ½å®Œå…¨æ»¡è¶³éœ€æ±‚
  - æ•°æ®å®Œå…¨æœ¬åœ°åŒ–ï¼Œç”¨æˆ·å®Œå…¨æŒæ§

### 2.5 å¼€å‘å·¥å…·
- **Biome 2.3.8**ï¼šä»£ç æ ¼å¼åŒ–å’Œæ£€æŸ¥ï¼ˆæ›¿ä»£ ESLint + Prettierï¼‰
- pytestï¼šPython æµ‹è¯•
- Vitestï¼šå‰ç«¯æµ‹è¯•
- electron-builder 26.0.12ï¼šåº”ç”¨æ‰“åŒ…
- tsx 4.21.0ï¼šTypeScript æ‰§è¡Œ

---

## ä¸‰ã€æ ¸å¿ƒäº¤äº’è®¾è®¡

### 3.1 ä¿¡æ¯æ¶æ„

```
Life Canvas OS
â”œâ”€â”€ å…¨å±€ç”»å¸ƒ (Canvas)
â”‚   â”œâ”€â”€ å…«ç»´é›·è¾¾å›¾
â”‚   â”œâ”€â”€ å­ç³»ç»Ÿæ¦‚è§ˆå¡ç‰‡
â”‚   â””â”€â”€ AI æ‘˜è¦ç®€æŠ¥
â”œâ”€â”€ ç¥ç»æ´å¯Ÿ (Insights)
â”‚   â””â”€â”€ AI åˆ†ææŠ¥å‘Šå¡ç‰‡
â”œâ”€â”€ æ—¶é—´è½´å®¡è®¡ (History)
â”‚   â””â”€â”€ å…¨ç³»ç»Ÿå†å²æ—¥å¿—æ—¶é—´è½´
â”œâ”€â”€ å…«å¤§å­ç³»ç»Ÿ (System Modules)
â”‚   â”œâ”€â”€ é¥®é£Ÿç³»ç»Ÿ (FUEL)
â”‚   â”œâ”€â”€ è¿åŠ¨ç³»ç»Ÿ (PHYSICAL)
â”‚   â”œâ”€â”€ è¯»ä¹¦ç³»ç»Ÿ (INTELLECTUAL)
â”‚   â”œâ”€â”€ å·¥ä½œç³»ç»Ÿ (OUTPUT)
â”‚   â”œâ”€â”€ æ¢¦æƒ³ç³»ç»Ÿ (RECOVERY)
â”‚   â”œâ”€â”€ è´¢åŠ¡ç³»ç»Ÿ (ASSET)
â”‚   â”œâ”€â”€ ç¤¾äº¤ç³»ç»Ÿ (CONNECTION)
â”‚   â””â”€â”€ ç¯å¢ƒç³»ç»Ÿ (ENVIRONMENT)
â””â”€â”€ å†…æ ¸é…ç½® (Settings)
    â”œâ”€â”€ ç”¨æˆ·æ¡£æ¡ˆ
    â”‚   â”œâ”€â”€ åŸºæœ¬ä¿¡æ¯ï¼ˆå§“åã€ç”Ÿæ—¥ã€MBTI ç­‰ï¼‰
    â”‚   â”œâ”€â”€ ä»·å€¼è§‚è®¾ç½®
    â”‚   â””â”€â”€ é¢„æœŸå¯¿å‘½
    â”œâ”€â”€ AI é…ç½®
    â”‚   â”œâ”€â”€ æä¾›å•†é€‰æ‹©ï¼ˆDeepSeek/è±†åŒ… äºŒé€‰ä¸€ï¼‰
    â”‚   â”œâ”€â”€ API å¯†é’¥é…ç½®ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰
    â”‚   â”œâ”€â”€ æ¨¡å‹åç§°è®¾ç½®ï¼ˆå¯é€‰ï¼Œä½¿ç”¨é»˜è®¤æ¨¡å‹ï¼‰
    â”‚   â””â”€â”€ API è¿é€šæ€§æµ‹è¯•
    â””â”€â”€ æ•°æ®ç®¡ç†
        â”œâ”€â”€ æ•°æ®å¯¼å‡ºï¼ˆJSON/CSVï¼‰
        â”œâ”€â”€ æ•°æ®å¯¼å…¥
        â””â”€â”€ æ•°æ®æ¸…é™¤ï¼ˆé‡ç½®åº”ç”¨ï¼‰
```

**AI é…ç½®è¯´æ˜ï¼š**
- ç”¨æˆ·ä» 2 ä¸ªæä¾›å•†ä¸­é€‰æ‹©ä¸€ä¸ªï¼ˆDeepSeek/è±†åŒ…ï¼‰
- æ¯æ¬¡åªèƒ½ä½¿ç”¨ä¸€ä¸ªæä¾›å•†ï¼Œåˆ‡æ¢æ—¶éœ€é‡æ–°é…ç½® API Key
- æä¾› API æµ‹è¯•åŠŸèƒ½ï¼ŒéªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®
- API Key ä½¿ç”¨ç³»ç»Ÿ Keychain + AES åŠ å¯†å­˜å‚¨

### 3.2 äº¤äº’æµç¨‹

#### 3.2.1 å¯åŠ¨æµç¨‹
```
ç”¨æˆ·å¯åŠ¨åº”ç”¨
    â†“
Electron ä¸»è¿›ç¨‹å¯åŠ¨
    â†“
å¯åŠ¨ Python åç«¯è¿›ç¨‹ï¼ˆå­è¿›ç¨‹ï¼‰
    â†“
Python åˆå§‹åŒ– SQLite æ•°æ®åº“ï¼ˆé¦–æ¬¡è¿è¡Œï¼‰
    â†“
å»ºç«‹ IPC é€šä¿¡é€šé“
    â†“
æ£€æŸ¥æ˜¯å¦å·²è®¾ç½® PIN ç 
    â†“
[é¦–æ¬¡ä½¿ç”¨] â†’ æ˜¾ç¤ºæ¬¢è¿é¡µ â†’ è®¾ç½® PIN ç  â†’ è¾“å…¥åŸºæœ¬ä¿¡æ¯
    â†“
[å·²è®¾ç½® PIN] â†’ æ˜¾ç¤º PIN è§£é”ç•Œé¢ â†’ éªŒè¯ PIN â†’ è¿›å…¥åº”ç”¨
    â†“
åŠ è½½ç”¨æˆ·é…ç½®å’Œç³»ç»ŸçŠ¶æ€
    â†“
æ˜¾ç¤ºå…¨å±€ç”»å¸ƒ
```

**è®¤è¯æ–¹æ¡ˆè¯´æ˜ï¼š**
- é‡‡ç”¨ **PIN ç ï¼ˆ6 ä½æ•°å­—ï¼‰** æ›¿ä»£å¤æ‚å¯†ç ç³»ç»Ÿ
- PIN ç ä½¿ç”¨ bcrypt å“ˆå¸Œå­˜å‚¨åœ¨æœ¬åœ°æ•°æ®åº“
- ä¼šè¯ä¿æŒåœ¨å†…å­˜ä¸­ï¼Œåº”ç”¨é”å®šåéœ€é‡æ–°è¾“å…¥ PIN
- å¯é€‰ï¼šä½¿ç”¨ SQLCipher åŠ å¯†æ•´ä¸ªæ•°æ®åº“ï¼ˆé«˜å®‰å…¨æ¨¡å¼ï¼‰


#### 3.2.2 æ ¸å¿ƒæ“ä½œæµ

**è¯„åˆ†æ›´æ–°æµ**
```
ç”¨æˆ·ç‚¹å‡»å­ç³»ç»Ÿå¡ç‰‡
    â†“
è¿›å…¥å­ç³»ç»Ÿè¯¦æƒ…é¡µ
    â†“
ç‚¹å‡» +/- æŒ‰é’®è°ƒæ•´è¯„åˆ†
    â†“
å‰ç«¯é€šè¿‡ IPC è°ƒç”¨ Python åç«¯
    â†“
Python æ›´æ–° SQLite æ•°æ®åº“
    â†“
è¿”å›æ›´æ–°åçš„æ•°æ®
    â†“
å‰ç«¯å®æ—¶æ›´æ–° UI å’Œé›·è¾¾å›¾åŠ¨ç”»
```

**AI æ´å¯Ÿæµ**
```
ç”¨æˆ·ç‚¹å‡»ã€Œå¯åŠ¨ AI æ´å¯Ÿã€
    â†“
æ”¶é›†å½“å‰å…«ç»´è¯„åˆ†æ•°æ®
    â†“
å‰ç«¯é€šè¿‡ IPC â†’ Python åç«¯ â†’ å¤§æ¨¡å‹ API
    â†“
ç­‰å¾…çŠ¶æ€ï¼ˆåŠ è½½åŠ¨ç”»ï¼‰
    â†“
Python è§£æå¤§æ¨¡å‹å“åº” â†’ éªŒè¯æ•°æ®
    â†“
å­˜å‚¨åˆ° SQLite insights è¡¨
    â†“
é€šè¿‡ IPC è¿”å›ç»“æ„åŒ–æ•°æ®
    â†“
å‰ç«¯æ¸²æŸ“æ´å¯Ÿå¡ç‰‡ï¼ˆåº†ç¥/è­¦å‘Š/è¡ŒåŠ¨ï¼‰
```

**å†å²è®°å½•æµ**
```
ç”¨æˆ·åœ¨å­ç³»ç»Ÿé¡µæ·»åŠ æ—¥å¿—
    â†“
å¡«å†™æ ‡ç­¾ + æè¿° + æ—¶é—´
    â†“
å‰ç«¯é€šè¿‡ IPC æäº¤åˆ° Python åç«¯
    â†“
Python å­˜å…¥ SQLite logs è¡¨
    â†“
è¿”å›æ–°æ—¥å¿—æ•°æ®
    â†“
å‰ç«¯å®æ—¶æ›´æ–°å†å²åˆ—è¡¨
    â†“
æ—¶é—´è½´å®¡è®¡é¡µåŒæ­¥æ›´æ–°
```

### 3.3 å…³é”®äº¤äº’ç»†èŠ‚

#### 3.3.1 é›·è¾¾å›¾äº¤äº’
- **æ‚¬åœ**ï¼šæ˜¾ç¤ºå…·ä½“ç»´åº¦åç§°å’Œæ•°å€¼
- **ç‚¹å‡»**ï¼šè·³è½¬è‡³å¯¹åº”å­ç³»ç»Ÿè¯¦æƒ…é¡µ
- **åŠ¨ç”»**ï¼šæ•°æ®å˜åŒ–æ—¶å¹³æ»‘è¿‡æ¸¡ï¼ˆ1s durationï¼‰

#### 3.3.2 å­ç³»ç»Ÿå¡ç‰‡
- **å¿«é€Ÿè°ƒæ•´**ï¼šæ‚¬åœæ—¶æ˜¾ç¤º +/- æŒ‰é’®ï¼Œç‚¹å‡»ç›´æ¥è°ƒæ•´è¯„åˆ†
- **æŸ¥çœ‹è¯¦æƒ…**ï¼šç‚¹å‡»å¡ç‰‡ä¸»ä½“è¿›å…¥è¯¦æƒ…é¡µ
- **çŠ¶æ€æŒ‡ç¤º**ï¼šè¯„åˆ†é¢œè‰²ç¼–ç ï¼ˆ>80 ç»¿è‰²ï¼Œ50-80 æ©™è‰²ï¼Œ<50 çº¢è‰²ï¼‰

#### 3.3.3 AI æ´å¯Ÿå¡ç‰‡
- **ç±»å‹åŒºåˆ†**ï¼š
  - åº†ç¥å‹ï¼ˆcelebrationï¼‰ï¼šç»¿è‰²ï¼ŒTrophy å›¾æ ‡
  - è­¦å‘Šå‹ï¼ˆwarningï¼‰ï¼šçº¢è‰²ï¼ŒAlertCircle å›¾æ ‡
  - è¡ŒåŠ¨å‹ï¼ˆactionï¼‰ï¼šè“è‰²ï¼ŒZap å›¾æ ‡
- **äº¤äº’**ï¼šç‚¹å‡»å¯å±•å¼€/æŠ˜å è¯¦ç»†å»ºè®®

#### 3.3.4 å“åº”å¼å¸ƒå±€
- ä¾§è¾¹æ ï¼šå›ºå®š 320px å®½åº¦
- ä¸»å†…å®¹åŒºï¼šè‡ªé€‚åº”ï¼Œæœ€å¤§å®½åº¦ 1400px
- ç½‘æ ¼ç³»ç»Ÿï¼šåŸºäº Tailwind çš„ 12 åˆ—ç½‘æ ¼

---

## å››ã€æ¨¡å—åˆ’åˆ†

### 4.1 æ•´ä½“æ¶æ„ï¼ˆå®‰å…¨æ–¹æ¡ˆï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Electron Main Process                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Python Backend (FastAPI)                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚   API      â”‚  â”‚    AI      â”‚  â”‚   SQLite DB      â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  Router    â”‚  â”‚  Service   â”‚  â”‚   (æœ¬åœ°æ–‡ä»¶)      â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†• IPC (è¿›ç¨‹é—´é€šä¿¡)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚            IPC Bridge (python-bridge)                    â”‚  â”‚
â”‚  â”‚   å°† FastAPI è°ƒç”¨è½¬æ¢ä¸º IPC æ¶ˆæ¯ï¼Œä¸æš´éœ² HTTP ç«¯å£         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†• IPC (å®‰å…¨é€šé“)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Electron Renderer                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              React Frontend                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Views  â”‚  â”‚Componentsâ”‚  â”‚   IPC Client Layer      â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®‰å…¨æ¶æ„è¯´æ˜ï¼š**
- Python åç«¯ä¸ Electron é€šè¿‡ **IPC é€šä¿¡**ï¼Œä¸å¯åŠ¨ HTTP æœåŠ¡å™¨
- æ¶ˆé™¤ç«¯å£å†²çªé£é™©
- æ¶ˆé™¤ CSRF æ”»å‡»é¢ï¼ˆæ¶æ„ç½‘é¡µæ— æ³•è®¿é—® IPC é€šé“ï¼‰
- è¿›ç¨‹é—´é€šä¿¡é€šè¿‡ Electron çš„ `ipcMain` å’Œ `ipcRenderer` è¿›è¡Œ
- Python åç«¯é€šè¿‡ **stdin/stdout** ä¸ Electron ä¸»è¿›ç¨‹é€šä¿¡

### 4.2 å‰ç«¯æ¨¡å— (Electron + React)

#### 4.2.1 å®é™…é¡¹ç›®ç»“æ„

> **æ³¨æ„ï¼š** ä»¥ä¸‹æ˜¯å½“å‰å®é™…çš„é¡¹ç›®ç»“æ„ã€‚è®¸å¤šä¸šåŠ¡æ¨¡å—ä»åœ¨å¼€å‘ä¸­ã€‚

```
src/
â”œâ”€â”€ main/                   # Electron ä¸»è¿›ç¨‹
â”‚   â”œâ”€â”€ index.ts           # ä¸»è¿›ç¨‹å…¥å£
â”‚   â”œâ”€â”€ python/            # Python åç«¯ç®¡ç†
â”‚   â”‚   â””â”€â”€ manager.ts     # Python è¿›ç¨‹ç®¡ç†å™¨
â”‚   â””â”€â”€ windows/           # çª—å£ç®¡ç†
â”‚       â””â”€â”€ main.ts        # ä¸»çª—å£å®šä¹‰
â”œâ”€â”€ preload/               # é¢„åŠ è½½è„šæœ¬
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ renderer/              # æ¸²æŸ“è¿›ç¨‹ï¼ˆå‰ç«¯ï¼‰
â”‚   â”œâ”€â”€ components/        # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ui/           # UI åŸºç¡€ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ alert.tsx # Alert ç»„ä»¶ç¤ºä¾‹
â”‚   â”‚   â”œâ”€â”€ canvas/       # ç”»å¸ƒç»„ä»¶ï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â”‚   â”œâ”€â”€ insights/     # AI æ´å¯Ÿç»„ä»¶ï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â”‚   â””â”€â”€ system/       # ç³»ç»Ÿç»„ä»¶ï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â”œâ”€â”€ hooks/            # React Hooksï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â”œâ”€â”€ lib/              # å·¥å…·åº“
â”‚   â”‚   â””â”€â”€ utils.ts      # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ pages/            # é¡µé¢ç»„ä»¶ï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â”œâ”€â”€ queries/          # TanStack Queryï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â”œâ”€â”€ screens/          # å±å¹•ç»„ä»¶ï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â”œâ”€â”€ index.html        # å…¥å£ HTML
â”‚   â”œâ”€â”€ index.tsx         # å…¥å£ React
â”‚   â””â”€â”€ routes.tsx        # è·¯ç”±é…ç½®
â”œâ”€â”€ shared/                # å…±äº«æ¨¡å—
â”‚   â”œâ”€â”€ constants.ts      # å¸¸é‡å®šä¹‰
â”‚   â”œâ”€â”€ types.ts          # TypeScript ç±»å‹
â”‚   â””â”€â”€ utils.ts          # å…±äº«å·¥å…·å‡½æ•°
â”œâ”€â”€ lib/electron-app/      # Electron åº”ç”¨å·¥å…·
â”‚   â”œâ”€â”€ factories/        # å·¥å‚æ¨¡å¼
â”‚   â”œâ”€â”€ utils/            # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ extensions/       # æ‰©å±•
â”‚   â””â”€â”€ release/          # å‘å¸ƒç›¸å…³
â””â”€â”€ resources/             # èµ„æºæ–‡ä»¶
```

#### 4.2.2 è§„åˆ’ä¸­çš„é¡µé¢æ¨¡å— (`/src/renderer/pages`)

```
pages/
â”œâ”€â”€ CanvasPage.tsx          # å…¨å±€ç”»å¸ƒä¸»é¡µï¼ˆå¾…å¼€å‘ï¼‰
â”œâ”€â”€ InsightsPage.tsx        # AI æ´å¯Ÿé¡µï¼ˆå¾…å¼€å‘ï¼‰
â”œâ”€â”€ HistoryPage.tsx         # æ—¶é—´è½´å®¡è®¡é¡µï¼ˆå¾…å¼€å‘ï¼‰
â”œâ”€â”€ SystemDetailPage.tsx    # å­ç³»ç»Ÿè¯¦æƒ…é¡µï¼ˆå¾…å¼€å‘ï¼‰
â””â”€â”€ SettingsPage.tsx        # è®¾ç½®é¡µï¼ˆå¾…å¼€å‘ï¼‰
```

#### 4.2.3 è§„åˆ’ä¸­çš„ç»„ä»¶æ¨¡å— (`/src/renderer/components`)

> **æ³¨æ„ï¼š** ä»¥ä¸‹æ˜¯è§„åˆ’ä¸­çš„ç»„ä»¶ç»“æ„ï¼Œå½“å‰åªæœ‰ `ui/alert.tsx` å­˜åœ¨ã€‚

```
components/
â”œâ”€â”€ ui/                     # shadcn/ui ç»„ä»¶ï¼ˆéƒ¨åˆ†å¼€å‘ä¸­ï¼‰
â”‚   â”œâ”€â”€ alert.tsx          # âœ… å·²å®ç°
â”‚   â”œâ”€â”€ button.tsx         # å¾…å¼€å‘
â”‚   â”œâ”€â”€ input.tsx          # å¾…å¼€å‘
â”‚   â”œâ”€â”€ select.tsx         # å¾…å¼€å‘
â”‚   â”œâ”€â”€ dialog.tsx         # å¾…å¼€å‘
â”‚   â”œâ”€â”€ toast.tsx          # å¾…å¼€å‘
â”‚   â””â”€â”€ ...
â”œâ”€â”€ layout/                 # å¸ƒå±€ç»„ä»¶ï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â”œâ”€â”€ Sidebar.tsx        # ä¾§è¾¹å¯¼èˆªæ 
â”‚   â””â”€â”€ Header.tsx         # é¡¶éƒ¨çŠ¶æ€æ 
â”œâ”€â”€ canvas/                 # ç”»å¸ƒç»„ä»¶ï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â”œâ”€â”€ RadarChart.tsx     # é›·è¾¾å›¾ç»„ä»¶
â”‚   â”œâ”€â”€ SystemCard.tsx     # ç³»ç»Ÿæ¦‚è§ˆå¡ç‰‡
â”‚   â””â”€â”€ AIBriefing.tsx     # AI æ‘˜è¦ç®€æŠ¥
â”œâ”€â”€ system/                 # å­ç³»ç»Ÿç»„ä»¶ï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â”œâ”€â”€ DietTracker.tsx    # é¥®é£Ÿè¿½è¸ªå™¨
â”‚   â”œâ”€â”€ PhysicalTracker.tsx # è¿åŠ¨è¿½è¸ªå™¨
â”‚   â”œâ”€â”€ IntellectualSystem.tsx # è¯»ä¹¦ç³»ç»Ÿ
â”‚   â”œâ”€â”€ OutputSystem.tsx   # å·¥ä½œäº§å‡ºç³»ç»Ÿ
â”‚   â”œâ”€â”€ RecoveryHub.tsx    # æ¢¦æƒ³æ¸…å•
â”‚   â”œâ”€â”€ FinanceDashboard.tsx # è´¢åŠ¡ä»ªè¡¨ç›˜
â”‚   â”œâ”€â”€ SocialEnergy.tsx   # ç¤¾äº¤èƒ½é‡
â”‚   â””â”€â”€ EnvironmentManager.tsx # ç¯å¢ƒç®¡ç†
â”œâ”€â”€ insights/               # AI æ´å¯Ÿç»„ä»¶ï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â””â”€â”€ InsightCard.tsx    # æ´å¯Ÿå¡ç‰‡
â”œâ”€â”€ history/                # å†å²è®°å½•ç»„ä»¶ï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â””â”€â”€ TimelineLog.tsx    # æ—¶é—´è½´æ—¥å¿—
â””â”€â”€ auth/                   # è®¤è¯ç»„ä»¶ï¼ˆå¾…å¼€å‘ï¼‰
    â””â”€â”€ AuthForm.tsx       # è®¤è¯è¡¨å•
```

#### 4.2.4 è§„åˆ’ä¸­çš„çŠ¶æ€ç®¡ç† (`/src/renderer/queries`)

> **æ³¨æ„ï¼š** TanStack Query é›†æˆå¾…å¼€å‘ã€‚

```
queries/
â”œâ”€â”€ useSystems.ts           # ç³»ç»Ÿæ•°æ®æŸ¥è¯¢ï¼ˆå¾…å¼€å‘ï¼‰
â”œâ”€â”€ useInsights.ts          # AI æ´å¯ŸæŸ¥è¯¢ï¼ˆå¾…å¼€å‘ï¼‰
â”œâ”€â”€ useLogs.ts              # ç³»ç»Ÿæ—¥å¿—æŸ¥è¯¢ï¼ˆå¾…å¼€å‘ï¼‰
â”œâ”€â”€ useJournal.ts           # ç”¨æˆ·æ—¥è®°æŸ¥è¯¢ï¼ˆå¾…å¼€å‘ï¼‰
â”œâ”€â”€ useUser.ts              # ç”¨æˆ·é…ç½®æŸ¥è¯¢ï¼ˆå¾…å¼€å‘ï¼‰
â””â”€â”€ mutations.ts            # ä¿®æ”¹æ“ä½œï¼ˆå¾…å¼€å‘ï¼‰
```

**React Query ä½¿ç”¨æ¨¡å¼ï¼š**
```typescript
// ç¤ºä¾‹ï¼šä½¿ç”¨ React Query ç®¡ç†ç³»ç»Ÿæ•°æ®
const { data: systems, isLoading } = useQuery({
  queryKey: ['systems'],
  queryFn: () => ipcClient.invoke('get_systems')
});

const updateScore = useMutation({
  mutationFn: ({ id, score }) => ipcClient.invoke('update_system_score', { id, score }),
  onSuccess: () => queryClient.invalidateQueries(['systems'])
});
```

#### 4.2.5 è§„åˆ’ä¸­çš„ Hooks (`/src/renderer/hooks`)

> **æ³¨æ„ï¼š** è‡ªå®šä¹‰ Hooks å¾…å¼€å‘ã€‚

```
hooks/
â”œâ”€â”€ useIPC.ts               # IPC é€šä¿¡å°è£…ï¼ˆå¾…å¼€å‘ï¼‰
â”œâ”€â”€ usePinLock.ts           # PIN é”å®šçŠ¶æ€ç®¡ç†ï¼ˆå¾…å¼€å‘ï¼‰
â””â”€â”€ useDatabaseHealth.ts    # æ•°æ®åº“å¥åº·ç›‘æ§ï¼ˆå¾…å¼€å‘ï¼‰
```

#### 4.2.6 è§„åˆ’ä¸­çš„ IPC å±‚

> **æ³¨æ„ï¼š** IPC å®¢æˆ·ç«¯å±‚å¾…å¼€å‘ï¼Œç›®å‰é€šä¿¡é€»è¾‘å¯èƒ½åœ¨ä¸»è¿›ç¨‹ä¸­å®ç°ã€‚

```
# è§„åˆ’ä¸­çš„ç»“æ„
src/renderer/ipc/           # IPC å®¢æˆ·ç«¯å±‚ï¼ˆå¾…å¼€å‘ï¼‰
â”œâ”€â”€ client.ts               # IPC å®¢æˆ·ç«¯å°è£…
â”œâ”€â”€ channels.ts             # é€šé“åç§°å¸¸é‡
â””â”€â”€ types.ts                # IPC æ¶ˆæ¯ç±»å‹å®šä¹‰

# å½“å‰å®ç°ä½ç½®
src/main/python/manager.ts  # Python è¿›ç¨‹ç®¡ç†ï¼ˆåŒ…å« IPC é€šä¿¡é€»è¾‘ï¼‰
```

### 4.3 åç«¯æ¨¡å— (Python + FastAPI)

#### 4.3.1 å®é™…é¡¹ç›®ç»“æ„

> **æ³¨æ„ï¼š** ä»¥ä¸‹æ˜¯å½“å‰å®é™…çš„åç«¯ç»“æ„ã€‚è®¸å¤šä¸šåŠ¡æ¨¡å—ä»åœ¨å¼€å‘ä¸­ã€‚

```
backend/
â”œâ”€â”€ main.py                 # âœ… åº”ç”¨å…¥å£
â”œâ”€â”€ api/                    # API è·¯ç”±æ¨¡å—ï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â”œâ”€â”€ __init__.py         # âœ… åŒ…åˆå§‹åŒ–æ–‡ä»¶
â”‚   â”œâ”€â”€ test.py             # âœ… æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ pin.py              # âŒ PIN è®¤è¯ APIï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â”œâ”€â”€ system.py           # âŒ ç³»ç»Ÿæ•°æ® APIï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â”œâ”€â”€ insight.py          # âŒ AI æ´å¯Ÿ APIï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â”œâ”€â”€ log.py              # âŒ ç³»ç»Ÿæ—¥å¿— APIï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â”œâ”€â”€ journal.py          # âŒ ç”¨æˆ·æ—¥è®° APIï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â”œâ”€â”€ ai_config.py        # âŒ AI é…ç½® APIï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â””â”€â”€ user.py             # âŒ ç”¨æˆ·é…ç½® APIï¼ˆå¾…å¼€å‘ï¼‰
â”œâ”€â”€ core/                   # æ ¸å¿ƒé€»è¾‘æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py         # âœ… åŒ…åˆå§‹åŒ–æ–‡ä»¶
â”‚   â”œâ”€â”€ health.py           # âœ… å¥åº·æ£€æŸ¥æ¨¡å—
â”‚   â”œâ”€â”€ security.py         # âŒ å®‰å…¨æ¨¡å—ï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â”œâ”€â”€ database.py         # âŒ æ•°æ®åº“è¿æ¥ï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â””â”€â”€ config.py           # âŒ é…ç½®ç®¡ç†ï¼ˆå¾…å¼€å‘ï¼‰
â”œâ”€â”€ models/                 # æ•°æ®æ¨¡å‹ï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â”œâ”€â”€ __init__.py         # âœ… åŒ…åˆå§‹åŒ–æ–‡ä»¶
â”‚   â”œâ”€â”€ user.py             # âŒ ç”¨æˆ·æ¨¡å‹
â”‚   â”œâ”€â”€ system.py           # âŒ ç³»ç»Ÿæ¨¡å‹
â”‚   â”œâ”€â”€ log.py              # âŒ æ—¥å¿—æ¨¡å‹
â”‚   â””â”€â”€ journal.py          # âŒ æ—¥è®°æ¨¡å‹
â”œâ”€â”€ schemas/                # Pydantic Schemaï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â”œâ”€â”€ __init__.py         # âœ… åŒ…åˆå§‹åŒ–æ–‡ä»¶
â”‚   â”œâ”€â”€ user.py             # âŒ ç”¨æˆ· Schema
â”‚   â”œâ”€â”€ system.py           # âŒ ç³»ç»Ÿ Schema
â”‚   â”œâ”€â”€ insight.py          # âŒ æ´å¯Ÿ Schema
â”‚   â”œâ”€â”€ log.py              # âŒ æ—¥å¿— Schema
â”‚   â”œâ”€â”€ journal.py          # âŒ æ—¥è®° Schema
â”‚   â””â”€â”€ ai_config.py        # âŒ AI é…ç½® Schema
â”œâ”€â”€ services/               # ä¸šåŠ¡æœåŠ¡ï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â”œâ”€â”€ __init__.py         # âœ… åŒ…åˆå§‹åŒ–æ–‡ä»¶
â”‚   â”œâ”€â”€ ai_service.py       # âŒ AI æœåŠ¡
â”‚   â”œâ”€â”€ insight_service.py  # âŒ æ´å¯ŸæœåŠ¡
â”‚   â”œâ”€â”€ encryption_service.py # âŒ åŠ å¯†æœåŠ¡
â”‚   â””â”€â”€ system_service.py   # âŒ ç³»ç»ŸæœåŠ¡
â”œâ”€â”€ db/                     # æ•°æ®åº“æ¨¡å—ï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â”œâ”€â”€ __init__.py         # âœ… åŒ…åˆå§‹åŒ–æ–‡ä»¶
â”‚   â”œâ”€â”€ session.py          # âŒ æ•°æ®åº“ä¼šè¯
â”‚   â””â”€â”€ init_db.py          # âŒ åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ build/                  # PyInstaller æ‰“åŒ…è¾“å‡º
â”‚   â””â”€â”€ backend/            # æ‰“åŒ…åçš„å¯æ‰§è¡Œæ–‡ä»¶
â””â”€â”€ dist/                   # æ„å»ºäº§ç‰©
```

#### 4.3.2 åŒæ¨¡å¼é€šä¿¡æ¶æ„

**å¼€å‘ç¯å¢ƒ vs ç”Ÿäº§ç¯å¢ƒï¼š**

| ç¯å¢ƒ | é€šä¿¡æ–¹å¼ | ä¼˜åŠ¿ | ä½¿ç”¨åœºæ™¯ |
|------|----------|------|----------|
| å¼€å‘ç¯å¢ƒ | HTTP (localhost:8000) | å¯ç›´æ¥ç”¨ Postman/curl æµ‹è¯•ï¼Œè°ƒè¯•æ–¹ä¾¿ | æœ¬åœ°å¼€å‘ |
| ç”Ÿäº§ç¯å¢ƒ | IPC (stdin/stdout) | æ— ç«¯å£å†²çªï¼Œæ—  CSRF é£é™© | æ‰“åŒ…ååº”ç”¨ |

**å¯åŠ¨æ¨¡å¼ï¼š**
```bash
# å¼€å‘æ¨¡å¼ï¼šå¯åŠ¨ HTTP æœåŠ¡å™¨
python main.py --dev

# ç”Ÿäº§æ¨¡å¼ï¼šIPC é€šä¿¡ï¼ˆElectron è°ƒç”¨ï¼‰
python main.py
```

---

#### 4.3.3 IPC é€šä¿¡åè®®ï¼ˆç”Ÿäº§æ¨¡å¼ï¼‰

**è¯·æ±‚æ ¼å¼ï¼ˆElectron â†’ Pythonï¼‰ï¼š**
```json
{
  "id": "unique-request-id",
  "action": "update_system_score",
  "params": { "system_id": "FUEL", "delta": 5 }
}
```

**å“åº”æ ¼å¼ï¼ˆPython â†’ Electronï¼‰ï¼š**
```json
{
  "id": "unique-request-id",
  "success": true,
  "data": { "new_score": 85 }
}
```

**åè®®è¯´æ˜ï¼š**
- ä¸å†æ¨¡æ‹Ÿ HTTP è·¯ç”±ï¼Œä½¿ç”¨ç›´æ¥å‡½æ•°è°ƒç”¨
- `action` å¯¹åº” Python åç«¯çš„å¤„ç†å‡½æ•°
- `params` ä¸ºå‡½æ•°å‚æ•°
- æ·»åŠ é•¿åº¦å‰ç¼€è§£å†³ç²˜åŒ…é—®é¢˜ï¼š`[JSONé•¿åº¦]\n[JSONå†…å®¹]`

#### 4.3.4 Action åˆ—è¡¨ï¼ˆå¼€å‘ç¯å¢ƒ HTTP + ç”Ÿäº§ç¯å¢ƒ IPCï¼‰

**PIN è®¤è¯æ¨¡å—**
| Action | HTTP ç«¯ç‚¹ | æè¿° |
|--------|-----------|------|
| setup_pin | POST /api/pin/setup | é¦–æ¬¡è®¾ç½® PIN |
| verify_pin | POST /api/pin/verify | éªŒè¯ PIN è§£é” |
| change_pin | POST /api/pin/change | ä¿®æ”¹ PIN |
| lock_app | POST /api/pin/lock | é”å®šåº”ç”¨ |

**ç³»ç»Ÿæ•°æ®æ¨¡å—**
| Action | HTTP ç«¯ç‚¹ | æè¿° |
|--------|-----------|------|
| get_systems | GET /api/systems | è·å–æ‰€æœ‰ç³»ç»ŸçŠ¶æ€ |
| get_system | GET /api/systems/{system_id} | è·å–å•ä¸ªç³»ç»Ÿè¯¦æƒ… |
| update_system_score | PATCH /api/systems/{system_id}/score | æ›´æ–°ç³»ç»Ÿè¯„åˆ† |
| update_system_stats | PATCH /api/systems/{system_id}/stats | æ›´æ–°ç³»ç»Ÿç»Ÿè®¡æ•°æ® |
| get_system_logs | GET /api/systems/{system_id}/logs | è·å–ç³»ç»Ÿæ—¥å¿— |

**AI æ´å¯Ÿæ¨¡å—**
| Action | HTTP ç«¯ç‚¹ | æè¿° |
|--------|-----------|------|
| generate_insights | POST /api/insights/generate | ç”Ÿæˆ AI æ´å¯ŸæŠ¥å‘Š |
| get_insights_history | GET /api/insights/history | è·å–å†å²æ´å¯Ÿè®°å½• |

**æ—¥å¿—æ¨¡å—**
| Action | HTTP ç«¯ç‚¹ | æè¿° |
|--------|-----------|------|
| add_log | POST /api/logs | æ·»åŠ æ–°æ—¥å¿— |
| get_logs | GET /api/logs | è·å–æ—¥å¿—åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µã€ç­›é€‰ï¼‰ |
| delete_log | DELETE /api/logs/{log_id} | åˆ é™¤æ—¥å¿— |

**ç”¨æˆ·é…ç½®æ¨¡å—**
| Action | HTTP ç«¯ç‚¹ | æè¿° |
|--------|-----------|------|
| get_user_config | GET /api/user/config | è·å–ç”¨æˆ·é…ç½® |
| update_user_config | PATCH /api/user/config | æ›´æ–°ç”¨æˆ·é…ç½®ï¼ˆå«åŸºæœ¬ä¿¡æ¯ï¼‰ |

**AI é…ç½®æ¨¡å—ï¼ˆç®€åŒ–ï¼šå•ä¸€é…ç½®ï¼‰**
| Action | HTTP ç«¯ç‚¹ | æè¿° |
|--------|-----------|------|
| get_ai_config | GET /api/ai/config | è·å–å½“å‰ AI é…ç½® |
| update_ai_config | PUT /api/ai/config | æ›´æ–° AI é…ç½®ï¼ˆæä¾›å•† + API Keyï¼‰ |
| test_ai_config | POST /api/ai/config/test | æµ‹è¯• API è¿é€šæ€§ |

**ç”¨æˆ·æ—¥è®°æ¨¡å—ï¼ˆæ–°å¢ï¼‰**
| Action | HTTP ç«¯ç‚¹ | æè¿° |
|--------|-----------|------|
| get_journals | GET /api/journal | è·å–æ—¥è®°åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µã€ç­›é€‰ï¼‰ |
| get_journal | GET /api/journal/{id} | è·å–å•æ¡æ—¥è®°è¯¦æƒ… |
| create_journal | POST /api/journal | åˆ›å»ºæ–°æ—¥è®° |
| update_journal | PUT /api/journal/{id} | æ›´æ–°æ—¥è®° |
| delete_journal | DELETE /api/journal/{id} | åˆ é™¤æ—¥è®° |
| get_journal_stats | GET /api/journal/stats | è·å–æ—¥è®°ç»Ÿè®¡ï¼ˆæŒ‰å¿ƒæƒ…ã€æ—¥æœŸåˆ†ç»„ï¼‰ |

**å¥åº·æ£€æŸ¥æ¨¡å—**
| Action | HTTP ç«¯ç‚¹ | æè¿° |
|--------|-----------|------|
| health | GET /api/health | å¥åº·æ£€æŸ¥ï¼ˆIPC å¿ƒè·³ç”¨ï¼‰ |
| ping | GET /api/ping | Ping æ£€æŸ¥ |

### 4.4 æ•°æ®åº“è®¾è®¡ï¼ˆSQLiteï¼‰

#### 4.4.1 æ•°æ®åº“ä½ç½®
```
macOS:  ~/Library/Application Support/Life Canvas OS/data.db
Windows: %APPDATA%/Life Canvas OS/data.db
Linux:  ~/.config/Life Canvas OS/data.db
```

#### 4.4.2 ER å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚user_profile  â”‚         â”‚user_settings â”‚         â”‚ ai_config    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)      â”‚    â”Œâ”€â”€â”€â–¶â”‚ id (PK)      â”‚         â”‚ user_id (PK) â”‚
â”‚ pin_hash     â”‚    â”‚    â”‚ theme        â”‚         â”‚ provider     â”‚
â”‚ display_name â”‚    â”‚    â”‚ language     â”‚         â”‚ api_key_enc  â”‚
â”‚ birthday     â”‚    â”‚    â”‚ auto_save... â”‚         â”‚ model_name   â”‚
â”‚ mbti         â”‚    â”‚    â”‚ sync_enabled â”‚         â”‚ created_at   â”‚
â”‚ values       â”‚    â”‚    â”‚ ...          â”‚         â”‚ updated_at   â”‚
â”‚ ...          â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                    â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                    â”‚                 â”‚                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚systems_base  â”‚      â”‚user_journal  â”‚  â”‚   insights    â”‚  â”‚action_items  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)      â”‚      â”‚ id (PK)      â”‚  â”‚ id (PK)      â”‚  â”‚ id (PK)      â”‚
â”‚ user_id (FK) â”‚      â”‚ user_id (FK) â”‚  â”‚ user_id (FK) â”‚  â”‚ system_id... â”‚
â”‚ type         â”‚      â”‚ title        â”‚  â”‚ content      â”‚  â”‚ text         â”‚
â”‚ score        â”‚      â”‚ content      â”‚  â”‚ system_scoresâ”‚  â”‚ completed    â”‚
â”‚ ...          â”‚      â”‚ mood         â”‚  â”‚ generated_at â”‚  â”‚ created_at   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ tags         â”‚  â”‚ created_at   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚              â”‚ created_at   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
   â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                          â”‚                  â”‚                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚systems_fuel  â”‚      â”‚systems_physi..â”‚  â”‚systems_intel.â”‚  â”‚systems_out.. â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ system_id    â”‚      â”‚ system_id    â”‚  â”‚ system_id    â”‚  â”‚ system_id    â”‚
â”‚ consistency  â”‚      â”‚ maintenance..â”‚  â”‚ total_sparks â”‚  â”‚ focus_hours..â”‚
â”‚ baseline_... â”‚      â”‚ weekly_plan  â”‚  â”‚ current_book â”‚  â”‚ tasks_compl..â”‚
â”‚ last_devia...â”‚      â”‚ progress     â”‚  â”‚ reading_prog â”‚  â”‚ current_okr  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚systems_recov.â”‚      â”‚systems_asset â”‚  â”‚systems_conne.â”‚  â”‚systems_envir.â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ system_id    â”‚      â”‚ system_id    â”‚  â”‚ system_id    â”‚  â”‚ system_id    â”‚
â”‚ total_dreams â”‚      â”‚ monthly_inc..â”‚  â”‚ social_energyâ”‚  â”‚ spaces_json  â”‚
â”‚ realized_... â”‚      â”‚ net_worth    â”‚  â”‚ total_friend â”‚  â”‚ inventory_...â”‚
â”‚ dreams_json  â”‚      â”‚ assets_json  â”‚  â”‚ friends_json â”‚  â”‚ overdue_task â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ liabilities..â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ next_maint...â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚     logs     â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚ id (PK)      â”‚
         â”‚ system_id(FK)â”‚
         â”‚ label        â”‚
         â”‚ value        â”‚
         â”‚ timestamp    â”‚
         â”‚ metadata     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¡¨å…³ç³»è¯´æ˜ï¼š**
- `user_profile` å’Œ `user_settings` æ˜¯ä¸€å¯¹ä¸€å…³ç³»
- `systems_base` æ˜¯æ‰€æœ‰å­ç³»ç»Ÿçš„å…¬å…±å­—æ®µè¡¨
- 8 ä¸ª `systems_*` è¡¨é€šè¿‡ `system_id` å…³è”åˆ° `systems_base`
- `logs` å’Œ `action_items` é€šè¿‡ `system_id` å…³è”åˆ° `systems_base`

#### 4.4.3 è¡¨ç»“æ„å®šä¹‰ï¼ˆSQLite DDLï¼‰

##### ç”¨æˆ·ç›¸å…³è¡¨

**user_profile è¡¨ï¼ˆç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼‰**
```sql
CREATE TABLE user_profile (
    id INTEGER PRIMARY KEY AUTOINCREMENT CHECK(id = 1),  -- ç”¨æˆ·å”¯ä¸€æ ‡è¯†ï¼Œå•ç”¨æˆ·åº”ç”¨å›ºå®šä¸º1
    pin_hash TEXT NOT NULL,                              -- bcrypt å“ˆå¸Œçš„6ä½PINç ï¼Œç©ºå­—ç¬¦ä¸²è¡¨ç¤ºæœªè®¾ç½®
    display_name TEXT NOT NULL DEFAULT 'User',           -- ç”¨æˆ·æ˜¾ç¤ºåç§°
    birthday DATE,                                       -- å‡ºç”Ÿæ—¥æœŸï¼Œæ ¼å¼ YYYY-MM-DDï¼Œç”¨äºè®¡ç®—ç”Ÿå‘½è¿›åº¦
    mbti TEXT,                                           -- MBTIæ€§æ ¼ç±»å‹ï¼Œ16ç§ç±»å‹ä¹‹ä¸€
    values TEXT,                                         -- ä»·å€¼è§‚ï¼ŒJSONæ•°ç»„æ ¼å¼ï¼Œå¦‚'["è‡ªç”±","åˆ›é€ åŠ›","æˆé•¿"]'
    life_expectancy INTEGER DEFAULT 85,                  -- é¢„æœŸå¯¿å‘½ï¼Œé»˜è®¤85å²ï¼Œç”¨äºç”Ÿå‘½å€’è®¡æ—¶
    locked_at TIMESTAMP,                                 -- åº”ç”¨é”å®šæ—¶é—´æˆ³ï¼Œç”¨äºè‡ªåŠ¨é”å®šåŠŸèƒ½
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,      -- è®°å½•åˆ›å»ºæ—¶é—´
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP       -- è®°å½•æœ€åæ›´æ–°æ—¶é—´
);

-- åˆå§‹åŒ–é»˜è®¤ç”¨æˆ·
INSERT INTO user_profile (id, pin_hash, display_name) VALUES (1, '', 'User');
```

**user_settings è¡¨ï¼ˆç”¨æˆ·é…ç½®ä¿¡æ¯ï¼‰**
```sql
CREATE TABLE user_settings (
    user_id INTEGER PRIMARY KEY DEFAULT 1,               -- å…³è”ç”¨æˆ·IDï¼Œå›ºå®šä¸º1
    theme TEXT DEFAULT 'light',                           -- ä¸»é¢˜è®¾ç½®ï¼šlight=äº®è‰², dark=æš—è‰², auto=è·Ÿéšç³»ç»Ÿ
    language TEXT DEFAULT 'zh-CN',                        -- ç•Œé¢è¯­è¨€ï¼Œé»˜è®¤ç®€ä½“ä¸­æ–‡
    auto_save_enabled INTEGER DEFAULT 1,                  -- è‡ªåŠ¨ä¿å­˜å¼€å…³ï¼Œ1=å¯ç”¨, 0=ç¦ç”¨
    auto_save_interval INTEGER DEFAULT 60,                -- è‡ªåŠ¨ä¿å­˜é—´éš”ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤60ç§’
    notification_enabled INTEGER DEFAULT 1,              -- é€šçŸ¥å¼€å…³ï¼Œæ˜¯å¦å¯ç”¨ç³»ç»Ÿé€šçŸ¥
    notification_time TEXT DEFAULT '09:00',               -- æ¯æ—¥æé†’æ—¶é—´
    show_year_progress INTEGER DEFAULT 1,                 -- æ˜¯å¦æ˜¾ç¤ºå¹´åº¦è¿›åº¦æ¡
    show_weekday INTEGER DEFAULT 1,                       -- æ˜¯å¦æ˜¾ç¤ºæ˜ŸæœŸå‡ 
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,      -- é…ç½®åˆ›å»ºæ—¶é—´
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,      -- é…ç½®æ›´æ–°æ—¶é—´
    FOREIGN KEY (user_id) REFERENCES user_profile(id) ON DELETE CASCADE
);

-- åˆå§‹åŒ–é»˜è®¤è®¾ç½®
INSERT INTO user_settings (user_id) VALUES (1);
```

**ai_config è¡¨ï¼ˆAIé…ç½®ï¼Œç®€åŒ–ä¸ºå•ä¸€é…ç½®ï¼‰**
```sql
CREATE TABLE ai_config (
    user_id INTEGER PRIMARY KEY DEFAULT 1,               -- å…³è”ç”¨æˆ·IDï¼Œå›ºå®šä¸º1
    provider TEXT NOT NULL CHECK(provider IN ('deepseek', 'doubao')),  -- AIæä¾›å•†
    api_key_enc TEXT NOT NULL,                           -- AES-256-GCMåŠ å¯†çš„APIå¯†é’¥
    model_name TEXT,                                     -- å¯é€‰ï¼šè‡ªå®šä¹‰æ¨¡å‹åç§°ï¼Œä¸ºç©ºä½¿ç”¨é»˜è®¤æ¨¡å‹
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,      -- é…ç½®åˆ›å»ºæ—¶é—´
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,      -- é…ç½®æ›´æ–°æ—¶é—´
    FOREIGN KEY (user_id) REFERENCES user_profile(id) ON DELETE CASCADE
);

-- æä¾›å•†é»˜è®¤æ¨¡å‹é…ç½®
-- deepseek: deepseek-chat
-- doubao: Doubao-pro-256k
```

##### ç”¨æˆ·æ—¥è®°è¡¨

**user_journal è¡¨ï¼ˆç”¨æˆ·æ—¥è®°/æ—¥å¿—ï¼‰**
```sql
CREATE TABLE user_journal (
    id INTEGER PRIMARY KEY AUTOINCREMENT,                -- æ—¥è®°å”¯ä¸€æ ‡è¯†
    user_id INTEGER NOT NULL DEFAULT 1,                  -- å…³è”ç”¨æˆ·ID
    title TEXT NOT NULL,                                 -- æ—¥è®°æ ‡é¢˜ï¼Œç®€çŸ­æè¿°
    content TEXT NOT NULL,                               -- æ—¥è®°æ­£æ–‡å†…å®¹ï¼Œæ”¯æŒé•¿æ–‡æœ¬
    mood TEXT CHECK(mood IN ('great', 'good', 'neutral', 'bad', 'terrible')),  -- å½“æ—¶å¿ƒæƒ…ï¼šgreat=å¾ˆå¥½, good=å¥½, neutral=ä¸€èˆ¬, bad=å·®, terrible=å¾ˆå·®
    tags TEXT,                                          -- æ ‡ç­¾ï¼ŒJSONæ•°ç»„æ ¼å¼ï¼Œå¦‚'["å·¥ä½œ","çªç ´","AI"]'
    related_system TEXT CHECK(related_system IN ('FUEL', 'PHYSICAL', 'INTELLECTUAL', 'OUTPUT', 'RECOVERY', 'ASSET', 'CONNECTION', 'ENVIRONMENT', NULL)),  -- å…³è”çš„ç³»ç»Ÿï¼Œå¯é€‰
    is_private INTEGER DEFAULT 1,                        -- æ˜¯å¦ç§å¯†ï¼Œ1=ç§å¯†(ä¸åŒæ­¥), 0=å…¬å¼€(æœªæ¥å¯èƒ½æ”¯æŒåˆ†äº«)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,      -- æ—¥è®°åˆ›å»ºæ—¶é—´
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,      -- æ—¥è®°æœ€åæ›´æ–°æ—¶é—´
    FOREIGN KEY (user_id) REFERENCES user_profile(id) ON DELETE CASCADE
);

CREATE INDEX idx_journal_created ON user_journal(created_at DESC);    -- æŒ‰åˆ›å»ºæ—¶é—´é™åºç´¢å¼•ï¼Œç”¨äºæ—¶é—´çº¿æŸ¥è¯¢
CREATE INDEX idx_journal_mood ON user_journal(mood);                 -- æŒ‰å¿ƒæƒ…ç´¢å¼•ï¼Œç”¨äºç»Ÿè®¡åˆ†æ
CREATE INDEX idx_journal_tags ON user_journal(tags);                 -- æŒ‰æ ‡ç­¾ç´¢å¼•ï¼Œç”¨äºæ ‡ç­¾æœç´¢
```

##### å­ç³»ç»Ÿç›¸å…³è¡¨

**systems_base è¡¨ï¼ˆå­ç³»ç»Ÿå…¬å…±å­—æ®µï¼‰**
```sql
CREATE TABLE systems_base (
    id INTEGER PRIMARY KEY AUTOINCREMENT,                -- ç³»ç»Ÿå”¯ä¸€æ ‡è¯†
    user_id INTEGER NOT NULL DEFAULT 1,                  -- å…³è”ç”¨æˆ·ID
    type TEXT NOT NULL CHECK(type IN ('FUEL', 'PHYSICAL', 'INTELLECTUAL',  -- ç³»ç»Ÿç±»å‹æšä¸¾
                                      'OUTPUT', 'RECOVERY', 'ASSET',
                                      'CONNECTION', 'ENVIRONMENT')),
    score INTEGER DEFAULT 50 CHECK(score BETWEEN 0 AND 100),  -- ç³»ç»Ÿè¯„åˆ†ï¼ŒèŒƒå›´0-100
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,      -- ç³»ç»Ÿåˆ›å»ºæ—¶é—´
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,      -- ç³»ç»Ÿæ›´æ–°æ—¶é—´
    UNIQUE(user_id, type),                               -- åŒä¸€ç”¨æˆ·æ¯ç§ç³»ç»Ÿç±»å‹åªèƒ½æœ‰ä¸€æ¡è®°å½•
    FOREIGN KEY (user_id) REFERENCES user_profile(id) ON DELETE CASCADE
);

CREATE INDEX idx_systems_base_user_type ON systems_base(user_id, type);  -- ç”¨æˆ·+ç±»å‹ç»„åˆç´¢å¼•
```

**systems_fuel è¡¨ï¼ˆé¥®é£Ÿç³»ç»Ÿä¸“å±å­—æ®µï¼‰**
```sql
CREATE TABLE systems_fuel (
    system_id INTEGER PRIMARY KEY,                       -- å…³è”systems_base.id
    consistency INTEGER DEFAULT 0 CHECK(consistency BETWEEN 0 AND 100),  -- ä¸€è‡´æ€§è¯„åˆ†ï¼Œä¸åŸºå‡†çš„ç¬¦åˆç¨‹åº¦
    baseline_breakfast TEXT,                            -- æ—©é¤åŸºå‡†é…ç½®ï¼ŒJSONæ ¼å¼
    baseline_lunch TEXT,                                -- åˆé¤åŸºå‡†é…ç½®ï¼ŒJSONæ ¼å¼
    baseline_dinner TEXT,                               -- æ™šé¤åŸºå‡†é…ç½®ï¼ŒJSONæ ¼å¼
    baseline_snacks TEXT,                               -- é›¶é£ŸåŸºå‡†é…ç½®ï¼ŒJSONæ ¼å¼ï¼Œå¦‚'{"enabled":false}'
    last_deviation TEXT,                                -- æœ€è¿‘åç¦»è®°å½•ï¼ŒJSONæ ¼å¼
    FOREIGN KEY (system_id) REFERENCES systems_base(id) ON DELETE CASCADE
);
```

**systems_physical è¡¨ï¼ˆè¿åŠ¨ç³»ç»Ÿä¸“å±å­—æ®µï¼‰**
```sql
CREATE TABLE systems_physical (
    system_id INTEGER PRIMARY KEY,                       -- å…³è”systems_base.id
    maintenance_index INTEGER DEFAULT 0 CHECK(maintenance_index BETWEEN 0 AND 100),  -- ç»´æŠ¤æŒ‡æ•°
    weekly_plan TEXT,                                   -- æœ¬å‘¨è¿åŠ¨è®¡åˆ’ï¼ŒJSONæ•°ç»„
    weekly_progress INTEGER DEFAULT 0 CHECK(weekly_progress BETWEEN 0 AND 100),  -- æœ¬å‘¨å®Œæˆè¿›åº¦
    last_workout_at TIMESTAMP,                          -- æœ€åè¿åŠ¨æ—¶é—´
    total_workout_hours REAL DEFAULT 0,                 -- ç´¯è®¡è¿åŠ¨å°æ—¶æ•°ï¼Œä¿ç•™1ä½å°æ•°
    FOREIGN KEY (system_id) REFERENCES systems_base(id) ON DELETE CASCADE
);
```

**systems_intellectual è¡¨ï¼ˆè¯»ä¹¦ç³»ç»Ÿä¸“å±å­—æ®µï¼‰**
```sql
CREATE TABLE systems_intellectual (
    system_id INTEGER PRIMARY KEY,                       -- å…³è”systems_base.id
    total_sparks INTEGER DEFAULT 0,                      -- ç´¯è®¡æ€æƒ³ç«èŠ±æ•°é‡ï¼ˆæ‘˜å½•ã€ç¬”è®°æ•°ï¼‰
    current_book_id TEXT,                               -- å½“å‰é˜…è¯»ä¹¦ç±çš„å”¯ä¸€æ ‡è¯†
    reading_progress INTEGER DEFAULT 0 CHECK(reading_progress BETWEEN 0 AND 100),  -- å½“å‰é˜…è¯»è¿›åº¦ç™¾åˆ†æ¯”
    last_read_at TIMESTAMP,                             -- æœ€åé˜…è¯»æ—¶é—´
    books_json TEXT,                                    -- ä¹¦ç±åˆ—è¡¨ï¼ŒJSONæ•°ç»„æ ¼å¼
    FOREIGN KEY (system_id) REFERENCES systems_base(id) ON DELETE CASCADE
);
```

**systems_output è¡¨ï¼ˆå·¥ä½œç³»ç»Ÿä¸“å±å­—æ®µï¼‰**
```sql
CREATE TABLE systems_output (
    system_id INTEGER PRIMARY KEY,                       -- å…³è”systems_base.id
    focus_hours_today REAL DEFAULT 0,                   -- ä»Šæ—¥ä¸“æ³¨å°æ—¶æ•°
    focus_hours_week REAL DEFAULT 0,                    -- æœ¬å‘¨ä¸“æ³¨å°æ—¶æ•°
    tasks_completed_today INTEGER DEFAULT 0,            -- ä»Šæ—¥å®Œæˆä»»åŠ¡æ•°
    current_okr TEXT,                                   -- å½“å‰OKRç›®æ ‡ï¼ŒJSONæ ¼å¼
    FOREIGN KEY (system_id) REFERENCES systems_base(id) ON DELETE CASCADE
);
```

**systems_recovery è¡¨ï¼ˆæ¢¦æƒ³ç³»ç»Ÿä¸“å±å­—æ®µï¼‰**
```sql
CREATE TABLE systems_recovery (
    system_id INTEGER PRIMARY KEY,                       -- å…³è”systems_base.id
    total_dreams INTEGER DEFAULT 0,                      -- æ€»æ¢¦æƒ³æ•°é‡
    realized_dreams INTEGER DEFAULT 0,                   -- å·²å®ç°æ¢¦æƒ³æ•°é‡
    progress_percentage REAL DEFAULT 0,                 -- å®Œæˆç™¾åˆ†æ¯”ï¼Œä¿ç•™2ä½å°æ•°
    dreams_json TEXT,                                   -- æ¢¦æƒ³åˆ—è¡¨ï¼ŒJSONæ•°ç»„æ ¼å¼
    FOREIGN KEY (system_id) REFERENCES systems_base(id) ON DELETE CASCADE
);
```

**systems_asset è¡¨ï¼ˆè´¢åŠ¡ç³»ç»Ÿä¸“å±å­—æ®µï¼‰**
```sql
CREATE TABLE systems_asset (
    system_id INTEGER PRIMARY KEY,                       -- å…³è”systems_base.id
    monthly_income REAL DEFAULT 0,                       -- æœˆæ”¶å…¥ï¼Œå•ä½ï¼šå…ƒ
    base_net_worth REAL DEFAULT 0,                      -- åŸºç¡€å‡€èµ„äº§ï¼Œå•ä½ï¼šå…ƒ
    current_net_worth REAL DEFAULT 0,                   -- å½“å‰å‡€èµ„äº§ï¼Œå•ä½ï¼šå…ƒ
    assets_json TEXT,                                   -- èµ„äº§æ˜ç»†ï¼ŒJSONæ ¼å¼
    liabilities_json TEXT,                              -- è´Ÿå€ºæ˜ç»†ï¼ŒJSONæ ¼å¼
    last_sync_at TIMESTAMP,                             -- æœ€ååŒæ­¥æ—¶é—´
    FOREIGN KEY (system_id) REFERENCES systems_base(id) ON DELETE CASCADE
);
```

**systems_connection è¡¨ï¼ˆç¤¾äº¤ç³»ç»Ÿä¸“å±å­—æ®µï¼‰**
```sql
CREATE TABLE systems_connection (
    system_id INTEGER PRIMARY KEY,                       -- å…³è”systems_base.id
    social_energy INTEGER DEFAULT 50 CHECK(social_energy BETWEEN 0 AND 100),  -- ç¤¾äº¤èƒ½é‡å€¼
    total_friends INTEGER DEFAULT 0,                     -- å¥½å‹æ€»æ•°
    close_friends INTEGER DEFAULT 0,                     -- å¯†å‹æ•°é‡
    last_interaction_at TIMESTAMP,                      -- æœ€åç¤¾äº¤æ—¶é—´
    friends_json TEXT,                                  -- å¥½å‹åˆ—è¡¨ï¼ŒJSONæ•°ç»„æ ¼å¼
    FOREIGN KEY (system_id) REFERENCES systems_base(id) ON DELETE CASCADE
);
```

**systems_environment è¡¨ï¼ˆç¯å¢ƒç³»ç»Ÿä¸“å±å­—æ®µï¼‰**
```sql
CREATE TABLE systems_environment (
    system_id INTEGER PRIMARY KEY,                       -- å…³è”systems_base.id
    spaces_json TEXT,                                   -- ç©ºé—´ç»´æŠ¤è®¡åˆ’åˆ—è¡¨ï¼ŒJSONæ•°ç»„æ ¼å¼
    inventory_json TEXT,                                -- ç‰©å“æ¸…å•ï¼ŒJSONæ•°ç»„æ ¼å¼
    overdue_tasks INTEGER DEFAULT 0,                     -- é€¾æœŸç»´æŠ¤ä»»åŠ¡æ•°
    next_maintenance_at TIMESTAMP,                      -- ä¸‹æ¬¡ç»´æŠ¤æ—¶é—´
    FOREIGN KEY (system_id) REFERENCES systems_base(id) ON DELETE CASCADE
);
```

##### ç³»ç»Ÿæ—¥å¿—ä¸è¡ŒåŠ¨é¡¹è¡¨

**logs è¡¨ï¼ˆç³»ç»Ÿæ—¥å¿—ï¼‰**
```sql
CREATE TABLE logs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,                -- æ—¥å¿—å”¯ä¸€æ ‡è¯†
    system_id INTEGER NOT NULL,                          -- å…³è”systems_base.id
    label TEXT NOT NULL,                                 -- æ—¥å¿—æ ‡ç­¾ï¼Œç®€çŸ­åˆ†ç±»
    value TEXT,                                         -- æ—¥å¿—è¯¦ç»†å†…å®¹
    metadata TEXT,                                      -- é¢å¤–å…ƒæ•°æ®ï¼ŒJSONæ ¼å¼
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,      -- æ—¥å¿—åˆ›å»ºæ—¶é—´
    FOREIGN KEY (system_id) REFERENCES systems_base(id) ON DELETE CASCADE
);

CREATE INDEX idx_logs_system_created ON logs(system_id, created_at DESC);  -- ç³»ç»ŸID+æ—¶é—´é™åºç´¢å¼•
```

**action_items è¡¨ï¼ˆè¡ŒåŠ¨é¡¹/é‡Œç¨‹ç¢‘ï¼‰**
```sql
CREATE TABLE action_items (
    id INTEGER PRIMARY KEY AUTOINCREMENT,                -- è¡ŒåŠ¨é¡¹å”¯ä¸€æ ‡è¯†
    system_id INTEGER NOT NULL,                          -- å…³è”systems_base.id
    text TEXT NOT NULL,                                  -- è¡ŒåŠ¨é¡¹/é‡Œç¨‹ç¢‘æè¿°
    completed INTEGER DEFAULT 0 CHECK(completed IN (0, 1)),  -- å®ŒæˆçŠ¶æ€ï¼Œ0=æœªå®Œæˆ, 1=å·²å®Œæˆ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,      -- åˆ›å»ºæ—¶é—´
    FOREIGN KEY (system_id) REFERENCES systems_base(id) ON DELETE CASCADE
);

CREATE INDEX idx_action_items_system_completed ON action_items(system_id, completed);  -- ç³»ç»ŸID+å®ŒæˆçŠ¶æ€ç´¢å¼•
```

##### AI æ´å¯Ÿè¡¨

**insights è¡¨ï¼ˆAIç”Ÿæˆçš„æ´å¯ŸæŠ¥å‘Šï¼‰**
```sql
CREATE TABLE insights (
    id INTEGER PRIMARY KEY AUTOINCREMENT,                -- æ´å¯ŸæŠ¥å‘Šå”¯ä¸€æ ‡è¯†
    user_id INTEGER NOT NULL DEFAULT 1,                  -- å…³è”ç”¨æˆ·ID
    content TEXT NOT NULL,                               -- æ´å¯Ÿå†…å®¹ï¼ŒJSONæ•°ç»„æ ¼å¼ï¼ŒåŒ…å«å¤šæ¡æ´å¯Ÿ
    system_scores TEXT,                                 -- ç”Ÿæˆæ—¶çš„ç³»ç»Ÿè¯„åˆ†å¿«ç…§ï¼ŒJSONæ ¼å¼
    provider_used TEXT,                                 -- ä½¿ç”¨çš„AIæä¾›å•†
    generated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,   -- ç”Ÿæˆæ—¶é—´
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,      -- è®°å½•åˆ›å»ºæ—¶é—´
    FOREIGN KEY (user_id) REFERENCES user_profile(id) ON DELETE CASCADE
);

CREATE INDEX idx_insights_user_generated ON insights(user_id, generated_at DESC);  -- ç”¨æˆ·+ç”Ÿæˆæ—¶é—´é™åºç´¢å¼•
```

#### 4.4.4 æ•°æ®åº“æŸ¥è¯¢ç¤ºä¾‹

**è·å–æŸä¸ªå­ç³»ç»Ÿçš„å®Œæ•´ä¿¡æ¯ï¼ˆå…¬å…±å­—æ®µ + ä¸“å±å­—æ®µï¼‰ï¼š**
```sql
-- è·å–é¥®é£Ÿç³»ç»Ÿå®Œæ•´ä¿¡æ¯
SELECT b.*, f.*
FROM systems_base b
LEFT JOIN systems_fuel f ON f.system_id = b.id
WHERE b.type = 'FUEL' AND b.user_id = 1;

-- è·å–è¿åŠ¨ç³»ç»Ÿå®Œæ•´ä¿¡æ¯
SELECT b.*, p.*
FROM systems_base b
LEFT JOIN systems_physical p ON p.system_id = b.id
WHERE b.type = 'PHYSICAL' AND b.user_id = 1;
```

**è·å–æ‰€æœ‰ç³»ç»ŸåŠå…¶è¯„åˆ†ï¼ˆç”¨äºé›·è¾¾å›¾ï¼‰ï¼š**
```sql
SELECT type, score
FROM systems_base
WHERE user_id = 1
ORDER BY type;
```

**ç”¨æˆ·æ—¥è®°ç»Ÿè®¡æŸ¥è¯¢ï¼š**
```sql
-- æŒ‰å¿ƒæƒ…ç»Ÿè®¡æ—¥è®°æ•°é‡
SELECT mood, COUNT(*) as count
FROM user_journal
WHERE user_id = 1
GROUP BY mood;

-- è·å–æœ€è¿‘çš„æ—¥è®°
SELECT id, title, mood, tags, created_at
FROM user_journal
WHERE user_id = 1
ORDER BY created_at DESC
LIMIT 20;
```

#### 4.4.5 SQLite é…ç½®ä¸åŠ å¯†

**Python SQLAlchemy é…ç½®ï¼š**
```python
# backend/core/database.py
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
import os
import sys
from pathlib import Path

# è·å–ç”¨æˆ·æ•°æ®ç›®å½•
if os.name == 'nt':  # Windows
    DATA_DIR = Path(os.environ['APPDATA']) / 'Life Canvas OS'
elif os.name == 'posix':  # macOS / Linux
    if sys.platform == 'darwin':
        DATA_DIR = Path.home() / 'Library' / 'Application Support' / 'Life Canvas OS'
    else:
        DATA_DIR = Path.home() / '.config' / 'life-canvas-os'

DATA_DIR.mkdir(parents=True, exist_ok=True)
DB_PATH = DATA_DIR / 'data.db'

# SQLite è¿æ¥å­—ç¬¦ä¸²
SQLALCHEMY_DATABASE_URL = f"sqlite:///{DB_PATH}"

# åˆ›å»ºå¼•æ“
engine = create_engine(
    SQLALCHEMY_DATABASE_URL,
    connect_args={"check_same_thread": False},  # SQLite å¤šçº¿ç¨‹å¿…éœ€
    echo=False  # ç”Ÿäº§ç¯å¢ƒè®¾ä¸º False
)

SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)
```

**API Key åŠ å¯†æ–¹æ¡ˆï¼š**
- **åŠ å¯†ç®—æ³•**ï¼šAES-256-GCM
- **å¯†é’¥ç®¡ç†**ï¼š
  - macOS: Keychain Services
  - Windows: Credential Manager
  - Linux: libsecret / Secret Service API
- **åŠ å¯†æµç¨‹**ï¼š
  1. é¦–æ¬¡é…ç½®æ—¶ç”Ÿæˆéšæœºä¸»å¯†é’¥ï¼ˆ256-bitï¼‰
  2. ä¸»å¯†é’¥å­˜å‚¨åˆ°ç³»ç»Ÿ Keychain
  3. API Key ä½¿ç”¨ä¸»å¯†é’¥åŠ å¯†åå­˜å‚¨åˆ° SQLite
  4. ä½¿ç”¨æ—¶ä» Keychain è¯»å–ä¸»å¯†é’¥è§£å¯†

### 4.5 Electron ä¸»è¿›ç¨‹æ¨¡å—

#### 4.5.1 å®é™…é¡¹ç›®ç»“æ„

> **æ³¨æ„ï¼š** ä»¥ä¸‹æ˜¯å½“å‰å®é™…çš„ä¸»è¿›ç¨‹ç»“æ„ã€‚

```
main/
â”œâ”€â”€ index.ts                # âœ… ä¸»è¿›ç¨‹å…¥å£
â”œâ”€â”€ python/                 # Python åç«¯ç®¡ç†
â”‚   â””â”€â”€ manager.ts          # âœ… Python è¿›ç¨‹ç®¡ç†å™¨
â””â”€â”€ windows/                # çª—å£ç®¡ç†
    â””â”€â”€ main.ts             # âœ… ä¸»çª—å£å®šä¹‰
```

#### 4.5.2 è§„åˆ’ä¸­çš„æ¨¡å—

> **æ³¨æ„ï¼š** ä»¥ä¸‹æ¨¡å—åœ¨è§„åˆ’ä¸­ï¼Œå¾…å¼€å‘ã€‚

```
main/
â”œâ”€â”€ ipc/                    # IPC å¤„ç†å™¨ï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â”œâ”€â”€ index.ts            # IPC å¤„ç†å™¨æ³¨å†Œ
â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”œâ”€â”€ system.ts       # ç³»ç»Ÿç›¸å…³ IPC
â”‚   â”‚   â””â”€â”€ database.ts     # æ•°æ®åº“æ“ä½œ IPC
â”‚   â””â”€â”€ channels.ts         # é€šé“åç§°å¸¸é‡
â”œâ”€â”€ python/
â”‚   â”œâ”€â”€ manager.ts          # âœ… å·²å®ç°
â”‚   â”œâ”€â”€ bridge.ts           # IPC ä¸ Python é€šä¿¡æ¡¥æ¥ï¼ˆå¾…å¼€å‘ï¼‰
â”‚   â””â”€â”€ monitor.ts          # åç«¯å¥åº·ç›‘æ§ï¼ˆå¾…å¼€å‘ï¼‰
â””â”€â”€ menu.ts                 # åº”ç”¨èœå•é…ç½®ï¼ˆå¾…å¼€å‘ï¼‰
```

#### 4.5.1 Python è¿›ç¨‹å¯åŠ¨ä¸é€šä¿¡

**Electron ç«¯ï¼šå¸¦å¥åº·æ£€æŸ¥çš„è¿›ç¨‹ç®¡ç†**
```typescript
// main/python/manager.ts
import { spawn, ChildProcess } from 'child_process';
import path from 'path';
import EventEmitter from 'events';

export class PythonManager extends EventEmitter {
  private process: ChildProcess | null = null;
  private healthCheckTimer?: NodeJS.Timeout;
  private responseCallbacks = new Map<string, (response: any) => void>();
  private stdoutBuffer = '';
  public isReady = false;

  start() {
    const isDev = process.env.NODE_ENV === 'development';
    const pythonPath = isDev
      ? 'python'  // å¼€å‘ç¯å¢ƒä½¿ç”¨ç³»ç»Ÿ Python
      : path.join(process.resourcesPath, 'python-runtime', 'backend');  // ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æ‰“åŒ…çš„å¯æ‰§è¡Œæ–‡ä»¶

    const args = isDev ? ['backend/main.py', '--dev'] : [];

    this.process = spawn(pythonPath, args, {
      stdio: ['pipe', 'pipe', 'pipe'],
      env: { ...process.env, PYTHONUNBUFFERED: '1' }
    });

    // ç›‘å¬ stdoutï¼ˆä½¿ç”¨é•¿åº¦å‰ç¼€åè®®ï¼‰
    this.process.stdout?.on('data', (data) => {
      this.stdoutBuffer += data.toString();
      this.processBuffer();
    });

    // ç›‘å¬ stderrï¼ˆæ—¥å¿—è¾“å‡ºï¼‰
    this.process.stderr?.on('data', (data) => {
      console.error('[Python]', data.toString());
    });

    // è¿›ç¨‹é€€å‡ºå¤„ç†
    this.process.on('exit', (code) => {
      console.error(`Python process exited with code ${code}`);
      this.isReady = false;
      this.stopHealthCheck();
      this.emit('exit', code);

      // è‡ªåŠ¨é‡å¯ï¼ˆéæ­£å¸¸é€€å‡ºæ—¶ï¼‰
      if (code !== 0 && code !== null) {
        setTimeout(() => this.restart(), 2000);
      }
    });

    // å¯åŠ¨å¥åº·æ£€æŸ¥
    this.startHealthCheck();
  }

  private processBuffer() {
    while (true) {
      const newlineIndex = this.stdoutBuffer.indexOf('\n');
      if (newlineIndex === -1) break;

      const lengthStr = this.stdoutBuffer.slice(0, newlineIndex);
      const length = parseInt(lengthStr);

      if (isNaN(length)) {
        // ä¸æ˜¯é•¿åº¦å‰ç¼€æ ¼å¼ï¼Œå¯èƒ½æ˜¯æ—¥å¿—ï¼Œè·³è¿‡
        this.stdoutBuffer = this.stdoutBuffer.slice(newlineIndex + 1);
        continue;
      }

      const jsonStart = newlineIndex + 1;
      const jsonEnd = jsonStart + length;

      if (this.stdoutBuffer.length < jsonEnd) break;  // æ•°æ®ä¸å®Œæ•´

      const jsonStr = this.stdoutBuffer.slice(jsonStart, jsonEnd);
      this.stdoutBuffer = this.stdoutBuffer.slice(jsonEnd);

      try {
        const response = JSON.parse(jsonStr);
        this.handleResponse(response);
      } catch (e) {
        console.error('Failed to parse response:', e);
      }
    }
  }

  private handleResponse(response: any) {
    // å¤„ç†å¥åº·æ£€æŸ¥å“åº”
    if (response.action === 'pong') {
      this.isReady = true;
      return;
    }

    // å¤„ç†ä¸šåŠ¡å“åº”
    const callback = this.responseCallbacks.get(response.id);
    if (callback) {
      callback(response);
      this.responseCallbacks.delete(response.id);
    }
  }

  async sendRequest(action: string, params: any = {}, timeout = 30000): Promise<any> {
    return new Promise((resolve, reject) => {
      const id = `${Date.now()}-${Math.random()}`;
      const request = { id, action, params };

      // è®¾ç½®è¶…æ—¶
      const timer = setTimeout(() => {
        this.responseCallbacks.delete(id);
        reject(new Error('Request timeout'));
      }, timeout);

      // æ³¨å†Œå›è°ƒ
      this.responseCallbacks.set(id, (response) => {
        clearTimeout(timer);
        if (response.success) {
          resolve(response.data);
        } else {
          reject(new Error(response.error || 'Unknown error'));
        }
      });

      // å‘é€è¯·æ±‚ï¼ˆé•¿åº¦å‰ç¼€æ ¼å¼ï¼‰
      const jsonStr = JSON.stringify(request);
      const message = `${Buffer.byteLength(jsonStr)}\n${jsonStr}`;
      this.process?.stdin.write(message);
    });
  }

  private startHealthCheck() {
    // æ¯ 30 ç§’å‘é€ ping
    this.healthCheckTimer = setInterval(async () => {
      try {
        await this.sendRequest('ping', {}, 5000);
      } catch (e) {
        console.error('Health check failed, restarting...');
        this.restart();
      }
    }, 30000);
  }

  private stopHealthCheck() {
    if (this.healthCheckTimer) {
      clearInterval(this.healthCheckTimer);
      this.healthCheckTimer = undefined;
    }
  }

  restart() {
    this.stop();
    setTimeout(() => this.start(), 1000);
  }

  stop() {
    this.stopHealthCheck();
    this.process?.kill();
    this.process = null;
    this.isReady = false;
  }
}
```

**Python ç«¯ï¼šåŒæ¨¡å¼å¯åŠ¨ä¸ Action è·¯ç”±**
```python
# backend/main.py
import sys
import json
import threading
from fastapi import FastAPI
from api import pin, system, insight, log, user
from core.health import register_handlers

app = FastAPI()

# æ³¨å†Œæ‰€æœ‰è·¯ç”±
app.include_router(pin.router, prefix="/api/pin", tags=["pin"])
app.include_router(system.router, prefix="/api/systems", tags=["systems"])
app.include_router(insight.router, prefix="/api/insights", tags=["insights"])
app.include_router(log.router, prefix="/api/logs", tags=["logs"])
app.include_router(user.router, prefix="/api/user", tags=["user"])
register_handlers(app)  # æ³¨å†Œå¥åº·æ£€æŸ¥å¤„ç†å™¨

# Action å¤„ç†å™¨æ˜ å°„ï¼ˆIPC æ¨¡å¼ï¼‰
ACTION_HANDLERS = {
    'ping': lambda params: {'action': 'pong'},
    'setup_pin': pin.setup_pin,
    'verify_pin': pin.verify_pin,
    'get_systems': system.get_systems,
    'update_system_score': system.update_system_score,
    # ... å…¶ä»– action æ˜ å°„
}

def ipc_loop():
    """IPC é€šä¿¡å¾ªç¯ï¼ˆç”Ÿäº§æ¨¡å¼ï¼‰"""
    for line in sys.stdin:
        try:
            # è§£æé•¿åº¦å‰ç¼€æ ¼å¼
            length = int(line.strip())
            json_data = sys.stdin.read(length)
            request = json.loads(json_data)

            # è·¯ç”±åˆ°å¯¹åº”çš„å¤„ç†å™¨
            handler = ACTION_HANDLERS.get(request['action'])
            if handler:
                result = handler(request.get('params', {}))
                response = {
                    'id': request['id'],
                    'success': True,
                    'data': result
                }
            else:
                response = {
                    'id': request['id'],
                    'success': False,
                    'error': f'Unknown action: {request["action"]}'
                }

            # å‘é€å“åº”ï¼ˆé•¿åº¦å‰ç¼€æ ¼å¼ï¼‰
            response_str = json.dumps(response)
            sys.stdout.write(f'{len(response_str.encode())}\n{response_str}')
            sys.stdout.flush()

        except Exception as e:
            error_response = {
                'id': request.get('id', ''),
                'success': False,
                'error': str(e)
            }
            error_str = json.dumps(error_response)
            sys.stdout.write(f'{len(error_str.encode())}\n{error_str}')
            sys.stdout.flush()

if __name__ == "__main__":
    if '--dev' in sys.argv:
        # å¼€å‘æ¨¡å¼ï¼šå¯åŠ¨ HTTP æœåŠ¡å™¨
        import uvicorn
        uvicorn.run(app, host="127.0.0.1", port=8000, log_level="info")
    else:
        # ç”Ÿäº§æ¨¡å¼ï¼šIPC é€šä¿¡
        # åœ¨å•ç‹¬çº¿ç¨‹ä¸­å¯åŠ¨ IPC å¾ªç¯
        ipc_thread = threading.Thread(target=ipc_loop, daemon=True)
        ipc_thread.start()

        # ä¿æŒä¸»çº¿ç¨‹è¿è¡Œ
        import time
        while True:
            time.sleep(1)
```

**å¥åº·æ£€æŸ¥æ¨¡å—ï¼ˆPython ç«¯ï¼‰ï¼š**
```python
# backend/core/health.py
from fastapi import APIRouter
from db.session import SessionLocal

router = APIRouter()

@router.get("/api/health")
async def health_check():
    """å¥åº·æ£€æŸ¥ç«¯ç‚¹"""
    try:
        # æµ‹è¯•æ•°æ®åº“è¿æ¥
        db = SessionLocal()
        db.execute("SELECT 1")
        db.close()
        return {"status": "healthy", "database": "connected"}
    except Exception as e:
        return {"status": "unhealthy", "error": str(e)}

@router.get("/api/ping")
async def ping():
    """Ping æ£€æŸ¥"""
    return {"action": "pong"}

def register_handlers(app):
    """æ³¨å†Œå¥åº·æ£€æŸ¥å¤„ç†å™¨åˆ° action æ˜ å°„"""
    ACTION_HANDLERS = {
        'health': lambda params: health_check(),
        'ping': lambda params: ping()
    }
    return ACTION_HANDLERS
```

---

## äº”ã€æ•°æ®æµè®¾è®¡

### 5.1 å‰ç«¯ â†’ åç«¯é€šä¿¡ï¼ˆIPC æ–¹æ¡ˆï¼‰

**IPC è¯·æ±‚æµ**
```
React Component
    â†“
è°ƒç”¨ IPC Client å±‚
    â†“
ipcRenderer.send('python-request', { id, method, path, body })
    â†“
Electron Main Process æ¥æ”¶
    â†“
é€šè¿‡ stdin å‘é€ç»™ Python è¿›ç¨‹
    â†“
Python è§£æ JSON â†’ è·¯ç”±åˆ° FastAPI å¤„ç†å™¨
    â†“
Pydantic Schema éªŒè¯
    â†“
ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼ˆService å±‚ï¼‰
    â†“
SQLite æ•°æ®åº“æ“ä½œ
    â†“
Python é€šè¿‡ stdout è¿”å› JSON å“åº”
    â†“
Electron æ¥æ”¶ â†’ é€šè¿‡ IPC è¿”å›ç»™æ¸²æŸ“è¿›ç¨‹
    â†“
å‰ç«¯æ›´æ–°çŠ¶æ€
```

### 5.2 AI æ´å¯Ÿç”Ÿæˆæµ

```
ç”¨æˆ·ç‚¹å‡»ã€Œå¯åŠ¨ AI æ´å¯Ÿã€
    â†“
å‰ç«¯é€šè¿‡ IPC è°ƒç”¨ POST /api/insights/generate
    â†“
Python åç«¯æ”¶é›†å½“å‰ç”¨æˆ·ç³»ç»Ÿè¯„åˆ†
    â†“
ä» user_ai_config è¡¨è·å–ç”¨æˆ·é…ç½®çš„ API å¯†é’¥
    â†“
è°ƒç”¨ AI Serviceï¼ˆæŒ‰ä¼˜å…ˆçº§é€‰æ‹©å¯ç”¨æ¨¡å‹ï¼‰
    â†“
æ„å»º Prompt â†’ å‘é€è¯·æ±‚åˆ°å¤§æ¨¡å‹ API
    â†“
è§£æ JSON å“åº” â†’ æ•°æ®éªŒè¯
    â†“
å­˜å‚¨åˆ° SQLite insights è¡¨
    â†“
é€šè¿‡ IPC è¿”å›ç»“æ„åŒ–æ•°æ®
    â†“
å‰ç«¯æ¸²æŸ“æ´å¯Ÿå¡ç‰‡
```

---

## å…­ã€å®‰å…¨è®¾è®¡

### 6.1 IPC é€šä¿¡å®‰å…¨
- **è¿›ç¨‹éš”ç¦»**ï¼šPython åç«¯ä¸æ¸²æŸ“è¿›ç¨‹å®Œå…¨éš”ç¦»
- **æ¶ˆæ¯éªŒè¯**ï¼šæ‰€æœ‰ IPC æ¶ˆæ¯æºå¸¦å”¯ä¸€ IDï¼Œé˜²æ­¢é‡æ”¾æ”»å‡»
- **æƒé™æ§åˆ¶**ï¼šä»…å…è®¸é¢„å®šä¹‰çš„ action è°ƒç”¨
- **æ—  HTTP æš´éœ²**ï¼šç”Ÿäº§ç¯å¢ƒä¸ç›‘å¬ä»»ä½•ç½‘ç»œç«¯å£ï¼Œå½»åº•æ¶ˆé™¤ CSRF é£é™©

### 6.2 PIN ç è®¤è¯å®‰å…¨
- **PIN æ ¼å¼**ï¼š6 ä½æ•°å­—ï¼Œç®€å•æ˜“è®°
- **å“ˆå¸Œå­˜å‚¨**ï¼šä½¿ç”¨ bcrypt å“ˆå¸Œå­˜å‚¨ï¼ŒåŠ ç›ä¿æŠ¤
- **å†…å­˜ä¼šè¯**ï¼šè§£é”çŠ¶æ€ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œåº”ç”¨é”å®šåéœ€é‡æ–°è¾“å…¥
- **å¤±è´¥é™åˆ¶**ï¼šè¿ç»­å¤±è´¥ 5 æ¬¡åå»¶è¿Ÿ 30 ç§’
- **å¯é€‰æ•°æ®åº“åŠ å¯†**ï¼šæ”¯æŒ SQLCipher åŠ å¯†æ•´ä¸ªæ•°æ®åº“ï¼ˆé«˜å®‰å…¨æ¨¡å¼ï¼‰

### 6.3 æ•°æ®å®‰å…¨
- **æ•°æ®åº“ä½ç½®**ï¼šSQLite æ–‡ä»¶å­˜å‚¨åœ¨ç”¨æˆ·æ•°æ®ç›®å½•
- **API Key åŠ å¯†**ï¼šä½¿ç”¨ç³»ç»Ÿ Keychain + AES-256-GCM åŠ å¯†
  - macOS: Keychain Services
  - Windows: Credential Manager
  - Linux: libsecret / Secret Service API
- **æ—¥å¿—å®‰å…¨**ï¼šæ•æ„Ÿæ•°æ®ï¼ˆPINã€API Keyï¼‰ä¸è®°å½•æ—¥å¿—
- **å¯é€‰åŠ å¯†**ï¼šç”¨æˆ·å¯é€‰æ‹©å¯ç”¨æ•°æ®åº“åŠ å¯†ï¼ˆä½¿ç”¨ SQLCipherï¼‰

### 6.4 Electron å®‰å…¨
```typescript
// main/index.ts
const mainWindow = new BrowserWindow({
  webPreferences: {
    nodeIntegration: false,       // ç¦ç”¨ Node é›†æˆ
    contextIsolation: true,       // å¯ç”¨ä¸Šä¸‹æ–‡éš”ç¦»
    sandbox: true,                // å¯ç”¨æ²™ç®±
    preload: path.join(__dirname, 'preload.js')
  }
});

// preload.js - æš´éœ²å®‰å…¨çš„ IPC API
contextBridge.exposeInMainWorld('electronAPI', {
  invoke: (channel: string, ...args: any[]) => {
    // ä»…å…è®¸ç™½åå•é€šé“
    const validChannels = ['python-request', 'db-query'];
    if (validChannels.includes(channel)) {
      return ipcRenderer.invoke(channel, ...args);
    }
  }
});
```

---

## ä¸ƒã€éƒ¨ç½²ä¸æ‰“åŒ…

### 7.1 å¼€å‘ç¯å¢ƒ
```bash
# å‰ç«¯
npm install
npm run dev

# åç«¯ï¼ˆå¼€å‘æ—¶å¯ç‹¬ç«‹è¿è¡Œï¼Œä¾¿äºè°ƒè¯•ï¼‰
cd backend
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
python main.py --dev  # å¼€å‘æ¨¡å¼ï¼ŒåŒæ—¶å¯åŠ¨ HTTP æœåŠ¡å™¨å’Œ IPC
```

### 7.2 ç”Ÿäº§æ‰“åŒ…
```bash
# 1. ä½¿ç”¨ PyInstaller æ‰“åŒ… Python åç«¯
cd backend
pyinstaller --onefile \
  --add-data "api:api" \
  --add-data "core:core" \
  --add-data "models:models" \
  --add-data "schemas:schemas" \
  --add-data "services:services" \
  --add-data "db:db" \
  --hidden-import fastapi \
  --hidden-import sqlalchemy \
  --hidden-import pydantic \
  main.py

# 2. æ‰“åŒ… Electron åº”ç”¨
npm run build
npm run package

# äº§ç‰©
dist/
â”œâ”€â”€ Life Canvas OS-dmg-x64.dmg     # macOS å®‰è£…åŒ…
â”œâ”€â”€ Life Canvas OS-win-x64.exe     # Windows å®‰è£…åŒ…
â””â”€â”€ Life Canvas OS-linux-x64.AppImage  # Linux å®‰è£…åŒ…

# Python åç«¯ä¼šè¢«åµŒå…¥åˆ°
# Contents/Resources/python-runtime/backend (macOS)
# resources/python-runtime/backend (Windows/Linux)
```

### 7.3 å¼€å‘ä¾èµ–æ¸…å•
```
# backend/requirements.txt
fastapi==0.104.1
uvicorn==0.24.0
sqlalchemy==2.0.23
pydantic==2.5.0
pydantic-settings==2.1.0
passlib[bcrypt]==1.7.4  # PIN å“ˆå¸Œ
cryptography==41.0.7     # API Key åŠ å¯†
openai==1.3.5            # å…¼å®¹ DeepSeek API
httpx==0.25.2            # å¼‚æ­¥ HTTP å®¢æˆ·ç«¯
python-dotenv==1.0.0     # ç¯å¢ƒå˜é‡ç®¡ç†
```

### 7.4 æ•°æ®åº“åˆå§‹åŒ–

**é¦–æ¬¡å¯åŠ¨è‡ªåŠ¨å»ºè¡¨ï¼š**
```python
# backend/db/init_db.py
from sqlalchemy import create_engine
from models import user_profile, user_settings, ai_config, system, journal
from core.database import engine

def init_database():
    """åˆå§‹åŒ–æ•°æ®åº“ï¼Œåˆ›å»ºæ‰€æœ‰è¡¨"""
    # åˆ›å»ºæ‰€æœ‰è¡¨
    user_profile.Base.metadata.create_all(bind=engine)
    user_settings.Base.metadata.create_all(bind=engine)
    ai_config.Base.metadata.create_all(bind=engine)

    # ç³»ç»Ÿç›¸å…³è¡¨
    system.SystemBase.metadata.create_all(bind=engine)
    system.SystemFuel.metadata.create_all(bind=engine)
    system.SystemPhysical.metadata.create_all(bind=engine)
    system.SystemIntellectual.metadata.create_all(bind=engine)
    system.SystemOutput.metadata.create_all(bind=engine)
    system.SystemRecovery.metadata.create_all(bind=engine)
    system.SystemAsset.metadata.create_all(bind=engine)
    system.SystemConnection.metadata.create_all(bind=engine)
    system.SystemEnvironment.metadata.create_all(bind=engine)

    # æ—¥å¿—å’Œè¡ŒåŠ¨é¡¹è¡¨
    system.Log.metadata.create_all(bind=engine)
    system.ActionItem.metadata.create_all(bind=engine)

    # æ—¥è®°å’Œæ´å¯Ÿè¡¨
    journal.UserJournal.metadata.create_all(bind=engine)
    journal.Insight.metadata.create_all(bind=engine)

    # æ’å…¥é»˜è®¤æ•°æ®
    from db.session import SessionLocal
    db = SessionLocal()

    try:
        # 1. æ’å…¥é»˜è®¤ç”¨æˆ·
        if not db.query(user_profile.UserProfile).first():
            default_user = user_profile.UserProfile(
                id=1,
                pin_hash='',  # ç©ºå“ˆå¸Œè¡¨ç¤ºæœªè®¾ç½® PIN
                display_name='User'
            )
            db.add(default_user)

        # 2. æ’å…¥é»˜è®¤è®¾ç½®
        if not db.query(user_settings.UserSettings).first():
            default_settings = user_settings.UserSettings(user_id=1)
            db.add(default_settings)

        # 3. æ’å…¥8ä¸ªé»˜è®¤ç³»ç»Ÿ
        for sys_type in ['FUEL', 'PHYSICAL', 'INTELLECTUAL', 'OUTPUT',
                         'RECOVERY', 'ASSET', 'CONNECTION', 'ENVIRONMENT']:
            if not db.query(system.SystemBase).filter_by(type=sys_type).first():
                # åˆ›å»ºå…¬å…±å­—æ®µ
                base_system = system.SystemBase(
                    user_id=1,
                    type=sys_type,
                    score=50
                )
                db.add(base_system)
                db.flush()  # è·å– ID

                # åˆ›å»ºä¸“å±å­—æ®µ
                if sys_type == 'FUEL':
                    db.add(system.SystemFuel(system_id=base_system.id))
                elif sys_type == 'PHYSICAL':
                    db.add(system.SystemPhysical(system_id=base_system.id))
                elif sys_type == 'INTELLECTUAL':
                    db.add(system.SystemIntellectual(system_id=base_system.id))
                elif sys_type == 'OUTPUT':
                    db.add(system.SystemOutput(system_id=base_system.id))
                elif sys_type == 'RECOVERY':
                    db.add(system.SystemRecovery(system_id=base_system.id))
                elif sys_type == 'ASSET':
                    db.add(system.SystemAsset(system_id=base_system.id))
                elif sys_type == 'CONNECTION':
                    db.add(system.SystemConnection(system_id=base_system.id))
                elif sys_type == 'ENVIRONMENT':
                    db.add(system.SystemEnvironment(system_id=base_system.id))

        db.commit()
        print("âœ… Database initialized successfully!")
        print("âœ… Created 8 systems with base and detail tables")

    except Exception as e:
        db.rollback()
        print(f"âŒ Initialization failed: {e}")
    finally:
        db.close()

if __name__ == "__main__":
    init_database()
```

**ç‰ˆæœ¬å‡çº§è¿ç§»è„šæœ¬ï¼ˆæŒ‰éœ€ï¼‰ï¼š**
```python
# backend/db/migrations/migration_002_add_journal_table.py
"""
ç‰ˆæœ¬ 1.1.0 è¿ç§»è„šæœ¬ï¼šæ·»åŠ ç”¨æˆ·æ—¥è®°åŠŸèƒ½
"""
def upgrade():
    from db.session import SessionLocal
    db = SessionLocal()
    try:
        # åˆ›å»ºæ—¥è®°è¡¨
        db.execute("""
            CREATE TABLE IF NOT EXISTS user_journal (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                user_id INTEGER NOT NULL DEFAULT 1,
                title TEXT NOT NULL,
                content TEXT NOT NULL,
                mood TEXT CHECK(mood IN ('great', 'good', 'neutral', 'bad', 'terrible')),
                tags TEXT,
                related_system TEXT,
                is_private INTEGER DEFAULT 1,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (user_id) REFERENCES user_profile(id) ON DELETE CASCADE
            )
        """)

        # åˆ›å»ºç´¢å¼•
        db.execute("CREATE INDEX IF NOT EXISTS idx_journal_created ON user_journal(created_at DESC)")
        db.execute("CREATE INDEX IF NOT EXISTS idx_journal_mood ON user_journal(mood)")

        db.commit()
        print("âœ… Migration 1.1.0 completed: Added user_journal table")

    except Exception as e:
        db.rollback()
        print(f"âŒ Migration failed: {e}")
    finally:
        db.close()

def downgrade():
    """å›æ»šè¿ç§»"""
    from db.session import SessionLocal
    db = SessionLocal()
    try:
        db.execute("DROP TABLE IF EXISTS user_journal")
        db.commit()
        print("âœ… Rollback completed: Dropped user_journal table")
    except Exception as e:
        db.rollback()
        print(f"âŒ Rollback failed: {e}")
    finally:
        db.close()
```

---

## å…«ã€åç»­æ‰©å±•æ–¹å‘

### 8.1 åŠŸèƒ½æ‰©å±•
- [ ] æ•°æ®å¯¼å…¥/å¯¼å‡ºï¼ˆCSV/JSON/Markdownï¼‰
- [ ] æ’ä»¶ç³»ç»Ÿæ”¯æŒè‡ªå®šä¹‰å­ç³»ç»Ÿ
- [ ] ç¤¾åŒºåˆ†äº«å­ç³»ç»Ÿé…ç½®æ¨¡æ¿
- [ ] æ•°æ®å¯è§†åŒ–æŠ¥å‘Šå¯¼å‡º PDF
- [ ] ç§»åŠ¨ç«¯é€‚é…ï¼ˆReact Native æˆ– Tauri ç§»æ¤ï¼‰
- [ ] å°ç»„ä»¶æ¨¡å¼ï¼ˆæ¡Œé¢å°ç»„ä»¶ï¼‰
- [ ] å…¨å±€å¿«æ·é”®æ”¯æŒ

### 8.2 AI å¢å¼º
- [ ] å¯¹è¯å¼ AI åŠ©æ‰‹é›†æˆï¼ˆæœ¬åœ° + äº‘ç«¯ï¼‰
- [ ] è‡ªåŠ¨åŒ–ç›®æ ‡æ‹†è§£å»ºè®®
- [ ] åŸºäºå†å²æ•°æ®çš„è¶‹åŠ¿é¢„æµ‹
- [ ] ä¸ªæ€§åŒ–ä¹ æƒ¯å…»æˆè®¡åˆ’
- [ ] AI è¾…åŠ©æ—¥è®°åˆ†æï¼ˆæƒ…ç»ªè¶‹åŠ¿ã€å…³é”®è¯æå–ï¼‰

### 8.3 æ•°æ®å®‰å…¨ä¸å¤‡ä»½
- [ ] å¯é€‰çš„äº‘ç«¯å¤‡ä»½åŠŸèƒ½ï¼ˆåŠ å¯†åä¸Šä¼ ï¼‰
- [ ] æ•°æ®åº“åŠ å¯†é€‰é¡¹ï¼ˆSQLCipherï¼‰
- [ ] è‡ªåŠ¨å¤‡ä»½åˆ°æŒ‡å®šç›®å½•
- [ ] æ•°æ®å¯¼å‡ºä¸ºåŠ å¯†å‹ç¼©åŒ…
- [ ] è·¨è®¾å¤‡æ•°æ®è¿ç§»å·¥å…·

### 8.4 ç¤¾äº¤ä¸åˆ†äº«ï¼ˆå¯é€‰ï¼‰
- [ ] åŒ¿åç¤¾åŒºåˆ†äº«ï¼ˆå¯å…¬å¼€æ—¥è®°å’Œæˆå°±ï¼‰
- [ ] å­ç³»ç»Ÿé…ç½®æ¨¡æ¿å¸‚åœº
- [ ] æˆå°±å¾½ç« ç³»ç»Ÿ
- [ ] æœˆåº¦/å¹´åº¦æŠ¥å‘Šç”Ÿæˆ

---

## é™„å½•ï¼šå¼€å‘ä¼˜å…ˆçº§å»ºè®®

### Phase 1: MVPï¼ˆæœ€å°å¯è¡Œäº§å“ï¼‰
1. âœ… åŸºç¡€é¡¹ç›®æ­å»ºï¼ˆElectron + React + Pythonï¼‰
2. âœ… SQLite æ•°æ®åº“è®¾è®¡ä¸è‡ªåŠ¨å»ºè¡¨ï¼ˆå­ç³»ç»Ÿè¡¨æ‹†åˆ†ï¼‰
3. âœ… åŒæ¨¡å¼é€šä¿¡æœºåˆ¶ï¼ˆå¼€å‘ HTTP + ç”Ÿäº§ IPCï¼‰
4. âœ… PIN è®¤è¯ç³»ç»Ÿ
5. âœ… å…«å¤§å­ç³»ç»Ÿ CRUDï¼ˆå…¬å…±å­—æ®µ + ä¸“å±å­—æ®µï¼‰
6. âœ… é›·è¾¾å›¾å¯è§†åŒ–
7. âœ… åŸºç¡€ AI æ´å¯ŸåŠŸèƒ½ï¼ˆDeepSeek/æ–‡å¿ƒ/è±†åŒ… ä¸‰é€‰ä¸€ï¼‰
8. âœ… Python è¿›ç¨‹å¥åº·æ£€æŸ¥
9. âœ… ç”¨æˆ·è®¾ç½®ç®¡ç†

### Phase 2: æ ¸å¿ƒåŠŸèƒ½å®Œå–„
1. â³ å„å­ç³»ç»Ÿè¯¦ç»†åŠŸèƒ½å®ç°ï¼ˆ8ä¸ªç³»ç»Ÿä¸“å±ç•Œé¢ï¼‰
2. â³ AI é…ç½®ç®¡ç†ä¸ API æµ‹è¯•åŠŸèƒ½
3. â³ å†å²è®°å½•ä¸æ—¶é—´è½´
4. â³ ç”¨æˆ·æ—¥è®°åŠŸèƒ½ï¼ˆæ–°å¢ï¼‰
5. â³ æ•°æ®å¯¼å…¥/å¯¼å‡º
6. â³ è¡ŒåŠ¨é¡¹/é‡Œç¨‹ç¢‘ç®¡ç†
7. â³ æ•°æ®å¤‡ä»½ä¸æ¢å¤

### Phase 3: ä½“éªŒä¼˜åŒ–
1. â³ UI/UX ç»†èŠ‚æ‰“ç£¨ï¼ˆshadcn/ui ç»„ä»¶å®šåˆ¶ï¼‰
2. â³ æ€§èƒ½ä¼˜åŒ–ï¼ˆæ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–ã€æ‡’åŠ è½½ï¼‰
3. â³ é”™è¯¯å¤„ç†ä¸æ—¥å¿—ç³»ç»Ÿ
4. â³ æ‰“åŒ…ä¸åˆ†å‘ï¼ˆmacOS/Windows/Linuxï¼‰
5. â³ åº”ç”¨å†…è‡ªåŠ¨æ›´æ–°
6. â³ å…¨å±€å¿«æ·é”®æ”¯æŒ

---

## é¡¹ç›®æ€»ç»“

### å½“å‰å®ç°çŠ¶æ€

> **æœ€åæ›´æ–°ï¼š** 2026-02-05

#### âœ… å·²å®Œæˆæ¨¡å—

**å‰ç«¯æ¡†æ¶ï¼š**
- âœ… Electron + React 19 åŸºç¡€æ¡†æ¶
- âœ… TypeScript é…ç½®
- âœ… Vite æ„å»ºç³»ç»Ÿ
- âœ… è·¯ç”±é…ç½®ï¼ˆ`src/renderer/routes.tsx`ï¼‰
- âœ… å…±äº«ç±»å‹å®šä¹‰ï¼ˆ`src/shared/types.ts`ï¼‰
- âœ… å…±äº«å¸¸é‡ï¼ˆ`src/shared/constants.ts`ï¼‰
- âœ… ä¸€ä¸ª UI ç»„ä»¶ç¤ºä¾‹ï¼ˆ`components/ui/alert.tsx`ï¼‰

**ä¸»è¿›ç¨‹ï¼š**
- âœ… ä¸»è¿›ç¨‹å…¥å£ï¼ˆ`src/main/index.ts`ï¼‰
- âœ… çª—å£ç®¡ç†ï¼ˆ`src/main/windows/main.ts`ï¼‰
- âœ… Python è¿›ç¨‹ç®¡ç†å™¨ï¼ˆ`src/main/python/manager.ts`ï¼‰

**åç«¯æ¡†æ¶ï¼š**
- âœ… FastAPI åº”ç”¨å…¥å£ï¼ˆ`backend/main.py`ï¼‰
- âœ… å¥åº·æ£€æŸ¥æ¨¡å—ï¼ˆ`backend/core/health.py`ï¼‰
- âœ… åŸºç¡€ç›®å½•ç»“æ„ï¼ˆapiã€coreã€dbã€modelsã€schemasã€servicesï¼‰

**æ„å»ºå·¥å…·ï¼š**
- âœ… Electron åº”ç”¨å·¥å‚æ¨¡å¼
- âœ… å‘å¸ƒå’Œæ„å»ºè„šæœ¬
- âœ… Biome ä»£ç æ ¼å¼åŒ–é…ç½®

#### ğŸ”´ å¾…å¼€å‘æ¨¡å—

**å‰ç«¯ä¸šåŠ¡é€»è¾‘ï¼š**
- âŒ æ‰€æœ‰é¡µé¢ç»„ä»¶ï¼ˆCanvasã€Insightsã€Historyã€Settingsã€SystemDetailï¼‰
- âŒ UI ç»„ä»¶åº“ï¼ˆButtonã€Inputã€Dialogã€Toast ç­‰ï¼‰
- âŒ å¸ƒå±€ç»„ä»¶ï¼ˆSidebarã€Headerï¼‰
- âŒ ä¸šåŠ¡ç»„ä»¶ï¼ˆ8ä¸ªå­ç³»ç»Ÿã€å›¾è¡¨ã€å¡ç‰‡ç­‰ï¼‰
- âŒ React Query é›†æˆ
- âŒ è‡ªå®šä¹‰ Hooksï¼ˆuseIPCã€usePinLockã€useDatabaseHealthï¼‰
- âŒ IPC å®¢æˆ·ç«¯å°è£…

**åç«¯ä¸šåŠ¡é€»è¾‘ï¼š**
- âŒ PIN è®¤è¯ç³»ç»Ÿ
- âŒ ç”¨æˆ·é…ç½®ç®¡ç†
- âŒ 8ä¸ªå­ç³»ç»Ÿ CRUD
- âŒ AI æ´å¯Ÿç”Ÿæˆ
- âŒ ç”¨æˆ·æ—¥è®°åŠŸèƒ½
- âŒ æ•°æ®åº“æ¨¡å‹å’Œåˆå§‹åŒ–
- âŒ æ‰€æœ‰ä¸šåŠ¡ API

#### ğŸ“Š å®ç°è¿›åº¦

| æ¨¡å—ç±»å‹ | è§„åˆ’æ•°é‡ | å·²å®ç° | å®ç°ç‡ |
|---------|---------|--------|--------|
| å‰ç«¯é¡µé¢ | 5 | 0 | 0% |
| UI ç»„ä»¶ | 20+ | 1 | ~5% |
| React Query Hooks | 6 | 0 | 0% |
| è‡ªå®šä¹‰ Hooks | 3 | 0 | 0% |
| ä¸»è¿›ç¨‹æ¨¡å— | 7 | 3 | 43% |
| åç«¯ API | 7 | 0 | 0% |
| åç«¯ Models | 4 | 0 | 0% |
| åç«¯ Schemas | 6 | 0 | 0% |
| åç«¯ Services | 4 | 0 | 0% |
| **æ€»è®¡** | **70+** | **4** | **~6%** |

---

### æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **æŠ€æœ¯æ ˆ** | Electron + React + Python + SQLite |
| **æ•°æ®å­˜å‚¨** | æœ¬åœ° SQLiteï¼Œå®Œå…¨æŒæ§ç”¨æˆ·æ•°æ® |
| **AI é›†æˆ** | æ”¯æŒ DeepSeek/æ–‡å¿ƒä¸€è¨€/è±†åŒ… ä¸‰é€‰ä¸€ |
| **è®¤è¯æ–¹å¼** | 6ä½ PIN ç  + å¯é€‰æ•°æ®åº“åŠ å¯† |
| **å­ç³»ç»Ÿ** | 8ä¸ªç»´åº¦ï¼Œå…¬å…±å­—æ®µ + ä¸“å±å­—æ®µè¡¨åˆ†ç¦» |
| **ç”¨æˆ·æ—¥è®°** | æ”¯æŒå¿ƒæƒ…è®°å½•ã€æ ‡ç­¾å…³è”ã€ç»Ÿè®¡åˆ†æ |
| **é€šä¿¡æ¶æ„** | å¼€å‘ç¯å¢ƒ HTTPï¼Œç”Ÿäº§ç¯å¢ƒ IPC |
| **è·¨å¹³å°** | æ”¯æŒ macOS/Windows/Linux |

### æ•°æ®åº“è¡¨æ¸…å•ï¼ˆ16ä¸ªè¡¨ï¼‰

**ç”¨æˆ·ç›¸å…³ï¼ˆ3ä¸ªï¼‰ï¼š**
- user_profileï¼ˆç”¨æˆ·èº«ä»½ï¼‰
- user_settingsï¼ˆç”¨æˆ·é…ç½®ï¼‰
- ai_configï¼ˆAIé…ç½®ï¼‰

**æ—¥è®°ä¸æ´å¯Ÿï¼ˆ2ä¸ªï¼‰ï¼š**
- user_journalï¼ˆç”¨æˆ·æ—¥è®°ï¼‰
- insightsï¼ˆAIæ´å¯Ÿï¼‰

**å­ç³»ç»Ÿï¼ˆ10ä¸ªï¼‰ï¼š**
- systems_baseï¼ˆå­ç³»ç»Ÿå…¬å…±å­—æ®µï¼‰
- systems_fuelï¼ˆé¥®é£Ÿç³»ç»Ÿï¼‰
- systems_physicalï¼ˆè¿åŠ¨ç³»ç»Ÿï¼‰
- systems_intellectualï¼ˆè¯»ä¹¦ç³»ç»Ÿï¼‰
- systems_outputï¼ˆå·¥ä½œç³»ç»Ÿï¼‰
- systems_recoveryï¼ˆæ¢¦æƒ³ç³»ç»Ÿï¼‰
- systems_assetï¼ˆè´¢åŠ¡ç³»ç»Ÿï¼‰
- systems_connectionï¼ˆç¤¾äº¤ç³»ç»Ÿï¼‰
- systems_environmentï¼ˆç¯å¢ƒç³»ç»Ÿï¼‰
- action_itemsï¼ˆè¡ŒåŠ¨é¡¹ï¼‰

**æ—¥å¿—ï¼ˆ1ä¸ªï¼‰ï¼š**
- logsï¼ˆç³»ç»Ÿæ—¥å¿—ï¼‰

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼šv3.0*
*æœ€åæ›´æ–°ï¼š2026-02-03*
